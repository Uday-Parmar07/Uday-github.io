<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>Behavioral Design Pattern in Golang | Uday Parmar</title>
<meta name="keywords" content="tech, golang">
<meta name="description" content="In the last blog post, I wrote about the Creational Design patterns, and I&rsquo;ll continue that series with Behavioral Design patterns in this post.
Now, we aren&rsquo;t going to define structures or encapsulate object creation, we will deal with behaviors.
Correct behavior design is the last step after knowing how to deal with object creation and structures. Defining the bheavior correctly is the last step of good software design because good software design lets us improve algorithms and fix errors easily while theb est algorithm implementation will not save use from bad software design.">
<meta name="author" content="map[name:Uday]">
<link rel="canonical" href="http://localhost:1313/archive/old_posts/behavioral-design-pattern-golang/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.e4ab7bca89e92a434b6ee0659c4052124b24f15cc9bbfa80e5b5201587388aba.css" integrity="sha256-5Kt7yonpKkNLbuBlnEBSEksk8VzJu/qA5bUgFYc4iro=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/archive/old_posts/behavioral-design-pattern-golang/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript> 

</head>

<body class=" dark" id="top">

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Uday Parmar (Alt + H)">Uday Parmar</a>
            <div class="logo-switches">
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about/" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/projects/" title="Projects">
                    <span>Projects</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/musings/" title="Essays">
                    <span>Essays</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="üîç (Alt &#43; /)" accesskey=/>
                    <span>üîç</span>
                </a>
            </li>
        </ul>
    </nav>
    
    
</header>
<main class="main">
<article class="post-single">
    <header class="post-header">
        
        <h1 class="post-title entry-hint-parent">
            Behavioral Design Pattern in Golang
        </h1>
        <div class="post-meta"><span title='2025-11-12 09:29:23 +0530 IST'>November 12, 2025</span>&nbsp;¬∑&nbsp;31 min&nbsp;¬∑&nbsp;map[name:Uday]

</div>
    </header> 
<figure class="entry-cover"><a href="http://localhost:1313/images/behavioral.png" target="_blank"
            rel="noopener noreferrer"><img loading="eager" src="http://localhost:1313/images/behavioral.png" alt=""></a>
        
</figure><div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#strategy-design-pattern" aria-label="Strategy Design Pattern">Strategy Design Pattern</a><ul>
                        
                <li>
                    <a href="#the-naive-approach-if-else" aria-label="The naive approach: if-else">The naive approach: if-else</a></li>
                <li>
                    <a href="#how-this-works" aria-label="How this works">How this works</a></li>
                <li>
                    <a href="#okay-but-what-happens-when-we-want-to-add-a-new-payment-method" aria-label="Okay, but what happens when we want to add a new payment method?">Okay, but what happens when we want to add a new payment method?</a></li>
                <li>
                    <a href="#whats-the-solution-then" aria-label="What&rsquo;s the solution then?">What&rsquo;s the solution then?</a></li>
                <li>
                    <a href="#its-still-not-right-though" aria-label="It&rsquo;s still not right though">It&rsquo;s still not right though</a></li>
                <li>
                    <a href="#doing-it-the-right-way-strategy-pattern" aria-label="Doing it the right way, Strategy Pattern">Doing it the right way, Strategy Pattern</a></li></ul>
                </li>
                <li>
                    <a href="#iterator-design-pattern" aria-label="Iterator Design Pattern">Iterator Design Pattern</a><ul>
                        
                <li>
                    <a href="#the-naive-approach" aria-label="The naive approach">The naive approach</a></li>
                <li>
                    <a href="#how-iterator-design-pattern-solves-this" aria-label="How Iterator Design pattern solves this">How Iterator Design pattern solves this</a></li></ul>
                </li>
                <li>
                    <a href="#mediator-design-pattern" aria-label="Mediator Design Pattern">Mediator Design Pattern</a><ul>
                        
                <li>
                    <a href="#objectives" aria-label="Objectives">Objectives</a></li>
                <li>
                    <a href="#example" aria-label="Example">Example</a></li>
                <li>
                    <a href="#naive-approach" aria-label="Naive approach">Naive approach</a></li>
                <li>
                    <a href="#tldr" aria-label="TLDR;">TLDR;</a></li></ul>
                </li>
                <li>
                    <a href="#state-design-pattern" aria-label="State Design Pattern">State Design Pattern</a><ul>
                        
                <li>
                    <a href="#example-1" aria-label="Example">Example</a></li>
                <li>
                    <a href="#when-things-get-ugly" aria-label="When things get ugly">When things get ugly</a></li>
                <li>
                    <a href="#issues-with-this-naive-approach" aria-label="Issues with this naive approach:">Issues with this naive approach:</a></li>
                <li>
                    <a href="#state-design-pattern-to-the-rescue" aria-label="State design pattern to the rescue">State design pattern to the rescue</a></li>
                <li>
                    <a href="#1-state-interface" aria-label="1. State interface">1. State interface</a></li>
                <li>
                    <a href="#2-adding-concrete-states" aria-label="2. Adding concrete states">2. Adding concrete states</a></li>
                <li>
                    <a href="#3-context-class" aria-label="3. Context Class">3. Context Class</a></li></ul>
                </li>
                <li>
                    <a href="#chain-of-responsibility-design-pattern" aria-label="Chain of Responsibility Design Pattern">Chain of Responsibility Design Pattern</a><ul>
                        
                <li>
                    <a href="#naive-approach-1" aria-label="Naive approach">Naive approach</a></li>
                <li>
                    <a href="#benefits-of-chain-responsiility-pattern" aria-label="Benefits of Chain responsiility pattern">Benefits of Chain responsiility pattern</a></li></ul>
                </li>
                <li>
                    <a href="#visitor-design-pattern" aria-label="Visitor Design Pattern">Visitor Design Pattern</a><ul>
                        
                <li>
                    <a href="#whats-wrong-here" aria-label="What&rsquo;s wrong here?">What&rsquo;s wrong here?</a></li>
                <li>
                    <a href="#step-1-define-the-patient-interface" aria-label="Step 1: Define the Patient interface">Step 1: Define the Patient interface</a></li>
                <li>
                    <a href="#step-2-concrete-patient-types" aria-label="Step 2: Concrete Patient Types">Step 2: Concrete Patient Types</a></li>
                <li>
                    <a href="#step-3-define-the-visitor-interface" aria-label="Step 3: Define the Visitor Interface">Step 3: Define the Visitor Interface</a></li>
                <li>
                    <a href="#step-4-create-concrete-visitors" aria-label="Step 4: Create Concrete Visitors">Step 4: Create Concrete Visitors</a></li>
                <li>
                    <a href="#billing-visitor" aria-label="Billing Visitor">Billing Visitor</a></li>
                <li>
                    <a href="#stitching-it-all-together" aria-label="Stitching it all together">Stitching it all together</a></li>
                <li>
                    <a href="#what-just-happened" aria-label="What Just Happened?">What Just Happened?</a></li></ul>
                </li>
                <li>
                    <a href="#memento-design-pattern" aria-label="Memento Design Pattern">Memento Design Pattern</a><ul>
                        
                <li>
                    <a href="#example-text-editor-with-edit-feature" aria-label="Example: Text Editor with Edit feature">Example: Text Editor with Edit feature</a></li>
                <li>
                    <a href="#naive-approach-2" aria-label="Naive approach">Naive approach</a></li>
                <li>
                    <a href="#whats-wrong-here-1" aria-label="What&rsquo;s wrong here?">What&rsquo;s wrong here?</a></li>
                <li>
                    <a href="#when-things-go-messy" aria-label="When things go messy">When things go messy</a></li>
                <li>
                    <a href="#how-memento-pattern-saves-the-day" aria-label="How Memento pattern saves the day">How Memento pattern saves the day</a></li>
                <li>
                    <a href="#advantages" aria-label="Advantages">Advantages</a></li></ul>
                </li>
                <li>
                    <a href="#command-design-pattern" aria-label="Command Design Pattern">Command Design Pattern</a><ul>
                        
                <li>
                    <a href="#what-problem-does-it-solve" aria-label="What Problem Does It Solve?">What Problem Does It Solve?</a></li>
                <li>
                    <a href="#step-1-define-the-command-interface" aria-label="Step 1: Define the Command Interface">Step 1: Define the Command Interface</a></li>
                <li>
                    <a href="#step-2-create-receiver-classes-actual-devices" aria-label="Step 2: Create Receiver Classes (Actual Devices)">Step 2: Create Receiver Classes (Actual Devices)</a></li>
                <li>
                    <a href="#step-3-concrete-command-implementations" aria-label="Step 3: Concrete Command Implementations">Step 3: Concrete Command Implementations</a></li>
                <li>
                    <a href="#step-4-the-invoker--the-remote-control" aria-label="Step 4: The Invoker ‚Äì The Remote Control">Step 4: The Invoker ‚Äì The Remote Control</a></li>
                <li>
                    <a href="#step-5-putting-it-all-together" aria-label="Step 5: Putting It All Together">Step 5: Putting It All Together</a></li>
                <li>
                    <a href="#why-this-pattern-rocks" aria-label="Why This Pattern Rocks">Why This Pattern Rocks</a></li></ul>
                </li>
                <li>
                    <a href="#observer-design-pattern" aria-label="Observer Design Pattern">Observer Design Pattern</a><ul>
                        
                <li>
                    <a href="#problem-manual-notifications-everywhere" aria-label="Problem: Manual Notifications Everywhere">Problem: Manual Notifications Everywhere</a></li>
                <li>
                    <a href="#enter-the-observer-pattern" aria-label="Enter the Observer Pattern">Enter the Observer Pattern</a></li>
                <li>
                    <a href="#step-1-defining-the-interfaces" aria-label="Step 1: Defining the Interfaces">Step 1: Defining the Interfaces</a></li>
                <li>
                    <a href="#step-2-creating-the-concrete-subject-weatherstation" aria-label="Step 2: Creating the Concrete Subject (WeatherStation)">Step 2: Creating the Concrete Subject (WeatherStation)</a></li>
                <li>
                    <a href="#step-3-creating-concrete-observers" aria-label="Step 3: Creating Concrete Observers">Step 3: Creating Concrete Observers</a></li>
                <li>
                    <a href="#step-4-putting-it-all-together" aria-label="Step 4: Putting It All Together">Step 4: Putting It All Together</a></li>
                <li>
                    <a href="#what-just-happened-1" aria-label="What Just Happened?">What Just Happened?</a></li>
                <li>
                    <a href="#advantages-of-the-observer-pattern" aria-label="Advantages of the Observer Pattern">Advantages of the Observer Pattern</a></li>
                <li>
                    <a href="#real-world-uses" aria-label="Real-World Uses">Real-World Uses</a></li>
                <li>
                    <a href="#wrap-up" aria-label="Wrap-Up">Wrap-Up</a></li></ul>
                </li>
                <li>
                    <a href="#template-method-design-pattern" aria-label="Template Method Design Pattern">Template Method Design Pattern</a><ul>
                        
                <li>
                    <a href="#the-core-idea" aria-label="The Core Idea">The Core Idea</a></li>
                <li>
                    <a href="#step-1-define-the-template-base-structure" aria-label="Step 1: Define the Template (Base Structure)">Step 1: Define the Template (Base Structure)</a></li>
                <li>
                    <a href="#step-2-concrete-implementations" aria-label="Step 2: Concrete Implementations">Step 2: Concrete Implementations</a></li>
                <li>
                    <a href="#step-3-putting-it-all-together" aria-label="Step 3: Putting It All Together">Step 3: Putting It All Together</a></li>
                <li>
                    <a href="#follow-up-adding-hooks-for-flexibility" aria-label="Follow-Up: Adding Hooks for Flexibility">Follow-Up: Adding Hooks for Flexibility</a></li>
                <li>
                    <a href="#why-use-the-template-method-pattern" aria-label="Why Use the Template Method Pattern?">Why Use the Template Method Pattern?</a></li>
                <li>
                    <a href="#real-world-analogy" aria-label="Real-World Analogy">Real-World Analogy</a></li>
                <li>
                    <a href="#to-wrap-it-up" aria-label="To wrap it up">To wrap it up</a></li></ul>
                </li>
                <li>
                    <a href="#tldr-1" aria-label="TLDR;">TLDR;</a>
                </li>
            </ul>
        </div>
    </details>
</div>

    <div class="post-content"><p>In the last blog post, I wrote about the Creational Design patterns, and I&rsquo;ll continue that series with Behavioral Design patterns in this post.</p>
<p>Now, we aren&rsquo;t going to define structures or encapsulate object creation, we will deal with behaviors.</p>
<p>Correct behavior design is the last step after knowing how to deal with object creation and structures. Defining the bheavior correctly is the last step of good software design because good software design lets us improve algorithms and fix errors easily while theb est algorithm implementation will not save use from bad software design.</p>
<h2 id="strategy-design-pattern">Strategy Design Pattern<a hidden class="anchor" aria-hidden="true" href="#strategy-design-pattern">#</a></h2>
<p><img loading="lazy" src="/images/strategy.png" alt="Strategy Design Pattern"  />
</p>
<p>This design pattern basically encapsulates the &ldquo;strategy&rdquo; employed while processing the same request. These algorithms are hidden behind an interface and, of course, must be interchangeable. All algos achieve the same functionality in a different way. For exmple, we could have a <code>Sort</code> interface and few sorting algorithms, but the result will be the same, no matter what algo we&rsquo;re using.</p>
<p>That&rsquo;s the thing with Strategy Design Pattern.</p>
<p>Let&rsquo;s take an example of a real-life scenario: Payment processing.</p>
<h3 id="the-naive-approach-if-else">The naive approach: if-else<a hidden class="anchor" aria-hidden="true" href="#the-naive-approach-if-else">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">PaymentProcessor</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="o">*</span><span class="nx">PaymentProcessor</span><span class="p">)</span><span class="w"> </span><span class="nf">ProcessPayment</span><span class="p">(</span><span class="nx">paymentMethod</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">switch</span><span class="w"> </span><span class="nx">paymentMethod</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">case</span><span class="w"> </span><span class="s">&#34;CreditCard&#34;</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Credit card processing logic</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Processing credit card payment...&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">case</span><span class="w"> </span><span class="s">&#34;PayPal&#34;</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Paypal payment processing logic</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Processing PayPal payment...&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">case</span><span class="w"> </span><span class="s">&#34;Crypto&#34;</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//  Crypto payment processing logic</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Processing crypto payment...&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">default</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Payment method not supported.&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">processor</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">PaymentProcessor</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">processor</span><span class="p">.</span><span class="nf">ProcessPayment</span><span class="p">(</span><span class="s">&#34;CreditCard&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">processor</span><span class="p">.</span><span class="nf">ProcessPayment</span><span class="p">(</span><span class="s">&#34;PayPal&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">processor</span><span class="p">.</span><span class="nf">ProcessPayment</span><span class="p">(</span><span class="s">&#34;Crypto&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">processor</span><span class="p">.</span><span class="nf">ProcessPayment</span><span class="p">(</span><span class="s">&#34;UPI&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="how-this-works">How this works<a hidden class="anchor" aria-hidden="true" href="#how-this-works">#</a></h3>
<ul>
<li>We have a single method called <code>ProcessPayment()</code></li>
<li>Inside the method, we check what type of payment method the user has selected using switch case.</li>
</ul>
<h3 id="okay-but-what-happens-when-we-want-to-add-a-new-payment-method">Okay, but what happens when we want to add a new payment method?<a hidden class="anchor" aria-hidden="true" href="#okay-but-what-happens-when-we-want-to-add-a-new-payment-method">#</a></h3>
<p>Good question, this is where this method gets messy.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="o">*</span><span class="nx">PaymentProcessor</span><span class="p">)</span><span class="w"> </span><span class="nf">ProcessPayment</span><span class="p">(</span><span class="nx">paymentMethod</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">switch</span><span class="w"> </span><span class="nx">paymentMethod</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">case</span><span class="w"> </span><span class="s">&#34;CreditCard&#34;</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Credit card processing logic</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Processing credit card payment...&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">case</span><span class="w"> </span><span class="s">&#34;PayPal&#34;</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Paypal payment processing logic</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Processing PayPal payment...&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">case</span><span class="w"> </span><span class="s">&#34;Crypto&#34;</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//  Crypto payment processing logic</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Processing crypto payment...&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s">&#34;Stripe&#34;</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Stripe payment processing logic</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Processing stripe payment...&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">default</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Payment method not supported.&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>Did you catch what&rsquo;s wrong here?</p>
<ol>
<li>Adding new payment methods, means we have to change the existing function, duplicating the same code again.</li>
<li>As we keep adding new methods, this switch case block becomes harder to write and maintain, and less flexible.
Also the readability takes a huge hit.</li>
</ol>
<h3 id="whats-the-solution-then">What&rsquo;s the solution then?<a hidden class="anchor" aria-hidden="true" href="#whats-the-solution-then">#</a></h3>
<p>One thing we could do is, instead of writing the logic inside the <code>case</code> statement, we could use an <code>interface</code> and then just call the interface method inside the <code>case</code> statement, something like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// PaymentMethod defines a common interface for all payment types.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">PaymentMethod</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nf">ProcessPayment</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// Implementations for each payment method</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">CreditCardPayment</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="nx">CreditCardPayment</span><span class="p">)</span><span class="w"> </span><span class="nf">ProcessPayment</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Processing credit card payment...&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">PayPalPayment</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="nx">PayPalPayment</span><span class="p">)</span><span class="w"> </span><span class="nf">ProcessPayment</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Processing PayPal payment...&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">CryptoPayment</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="nx">CryptoPayment</span><span class="p">)</span><span class="w"> </span><span class="nf">ProcessPayment</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Processing crypto payment...&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">StripePayment</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="nx">StripePayment</span><span class="p">)</span><span class="w"> </span><span class="nf">ProcessPayment</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Processing Stripe payment...&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// PaymentProcessor handles different payment methods.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">PaymentProcessor</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="nx">PaymentProcessor</span><span class="p">)</span><span class="w"> </span><span class="nf">ProcessPayment</span><span class="p">(</span><span class="nx">paymentMethod</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="kd">var</span><span class="w"> </span><span class="nx">method</span><span class="w"> </span><span class="nx">PaymentMethod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">switch</span><span class="w"> </span><span class="nx">paymentMethod</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">case</span><span class="w"> </span><span class="s">&#34;CreditCard&#34;</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">method</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">CreditCardPayment</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">case</span><span class="w"> </span><span class="s">&#34;PayPal&#34;</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">method</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">PayPalPayment</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">case</span><span class="w"> </span><span class="s">&#34;Crypto&#34;</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">method</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">CryptoPayment</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">case</span><span class="w"> </span><span class="s">&#34;Stripe&#34;</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">method</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">StripePayment</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">default</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Payment method not supported.&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">return</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">method</span><span class="p">.</span><span class="nf">ProcessPayment</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">processor</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">PaymentProcessor</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">processor</span><span class="p">.</span><span class="nf">ProcessPayment</span><span class="p">(</span><span class="s">&#34;CreditCard&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">processor</span><span class="p">.</span><span class="nf">ProcessPayment</span><span class="p">(</span><span class="s">&#34;PayPal&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">processor</span><span class="p">.</span><span class="nf">ProcessPayment</span><span class="p">(</span><span class="s">&#34;Crypto&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">processor</span><span class="p">.</span><span class="nf">ProcessPayment</span><span class="p">(</span><span class="s">&#34;Stripe&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">processor</span><span class="p">.</span><span class="nf">ProcessPayment</span><span class="p">(</span><span class="s">&#34;UPI&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="its-still-not-right-though">It&rsquo;s still not right though<a hidden class="anchor" aria-hidden="true" href="#its-still-not-right-though">#</a></h3>
<p>Even though we&rsquo;ve resolved the readability, it&rsquo;s still has code duplication and poor maintainability.</p>
<h3 id="doing-it-the-right-way-strategy-pattern">Doing it the right way, Strategy Pattern<a hidden class="anchor" aria-hidden="true" href="#doing-it-the-right-way-strategy-pattern">#</a></h3>
<p>The first step would be to define a common interface</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// PaymentStrategy defines the interface for all payment strategies</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">PaymentStrategy</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nf">ProcessPayment</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// Concrete strategy for Credit Card payment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">CreditCardPayment</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="nx">CreditCardPayment</span><span class="p">)</span><span class="w"> </span><span class="nf">ProcessPayment</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Processing credit card payment...&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// Concrete strategy for PayPal payment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">PayPalPayment</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="nx">PayPalPayment</span><span class="p">)</span><span class="w"> </span><span class="nf">ProcessPayment</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Processing PayPal payment...&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// Concrete strategy for Crypto payment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">CryptoPayment</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="nx">CryptoPayment</span><span class="p">)</span><span class="w"> </span><span class="nf">ProcessPayment</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Processing crypto payment...&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// Concrete strategy for Stripe payment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">StripePayment</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="nx">StripePayment</span><span class="p">)</span><span class="w"> </span><span class="nf">ProcessPayment</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Processing Stripe payment...&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// PaymentProcessor uses a PaymentStrategy to process payments</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">PaymentProcessor</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">paymentStrategy</span><span class="w"> </span><span class="nx">PaymentStrategy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// NewPaymentProcessor is a constructor for PaymentProcessor</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="nf">NewPaymentProcessor</span><span class="p">(</span><span class="nx">strategy</span><span class="w"> </span><span class="nx">PaymentStrategy</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">PaymentProcessor</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">PaymentProcessor</span><span class="p">{</span><span class="nx">paymentStrategy</span><span class="p">:</span><span class="w"> </span><span class="nx">strategy</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// ProcessPayment delegates payment processing to the current strategy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="o">*</span><span class="nx">PaymentProcessor</span><span class="p">)</span><span class="w"> </span><span class="nf">ProcessPayment</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">p</span><span class="p">.</span><span class="nx">paymentStrategy</span><span class="p">.</span><span class="nf">ProcessPayment</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// SetPaymentStrategy dynamically changes the payment strategy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="o">*</span><span class="nx">PaymentProcessor</span><span class="p">)</span><span class="w"> </span><span class="nf">SetPaymentStrategy</span><span class="p">(</span><span class="nx">strategy</span><span class="w"> </span><span class="nx">PaymentStrategy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">p</span><span class="p">.</span><span class="nx">paymentStrategy</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">strategy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// Example usage</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="c1">// Create instances of each payment strategy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">creditCard</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">CreditCardPayment</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">payPal</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">PayPalPayment</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">crypto</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">CryptoPayment</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">stripe</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">StripePayment</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="c1">// Create a payment processor using the credit card strategy initially</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">processor</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nf">NewPaymentProcessor</span><span class="p">(</span><span class="nx">creditCard</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">processor</span><span class="p">.</span><span class="nf">ProcessPayment</span><span class="p">()</span><span class="w"> </span><span class="c1">// Processing credit card payment...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="c1">// Dynamically change strategies at runtime</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">processor</span><span class="p">.</span><span class="nf">SetPaymentStrategy</span><span class="p">(</span><span class="nx">payPal</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">processor</span><span class="p">.</span><span class="nf">ProcessPayment</span><span class="p">()</span><span class="w"> </span><span class="c1">// Processing PayPal payment...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">processor</span><span class="p">.</span><span class="nf">SetPaymentStrategy</span><span class="p">(</span><span class="nx">crypto</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">processor</span><span class="p">.</span><span class="nf">ProcessPayment</span><span class="p">()</span><span class="w"> </span><span class="c1">// Processing crypto payment...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">processor</span><span class="p">.</span><span class="nf">SetPaymentStrategy</span><span class="p">(</span><span class="nx">stripe</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">processor</span><span class="p">.</span><span class="nf">ProcessPayment</span><span class="p">()</span><span class="w"> </span><span class="c1">// Processing Stripe payment...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h2 id="iterator-design-pattern">Iterator Design Pattern<a hidden class="anchor" aria-hidden="true" href="#iterator-design-pattern">#</a></h2>
<p><img loading="lazy" src="/images/iterator.png" alt="Iterator Design Pattern"  />

This design pattern allows us to traverse a collection of objects without exposing the underlying implementation details.</p>
<p>We use this pattern when we want to decouple the way we access elements from the collection&rsquo;s underlying data structure, allowing us to write cleaner, more maintainable code.</p>
<p>Let&rsquo;s take the example of a music streaming applicationk, and one of core features of this app is a playlist. Usersw can add songs to their playlists, and they should be able to iterate through their playlist to listen to each song one by one.</p>
<p>There might be different way or orders to a playlist which a user can demand:</p>
<ul>
<li>A playlist which has the songs in the order they were added by the user.</li>
<li>Random shuffled playlist</li>
<li>&ldquo;Liked&rdquo; songs, by particular time period</li>
</ul>
<h3 id="the-naive-approach">The naive approach<a hidden class="anchor" aria-hidden="true" href="#the-naive-approach">#</a></h3>
<p>One way which comes to mind first is, yes you guessed it right, just &ldquo;iterating&rdquo; over the list. Here&rsquo;s how you might do it in golang:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">Playlist</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">songs</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// NewPlaylist creates and returns a new empty playlist.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="nf">NewPlaylist</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="nx">Playlist</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Playlist</span><span class="p">{</span><span class="nx">songs</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{}}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="o">*</span><span class="nx">Playlist</span><span class="p">)</span><span class="w"> </span><span class="nf">AddSong</span><span class="p">(</span><span class="nx">song</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">s</span><span class="p">.</span><span class="nx">songs</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">songs</span><span class="p">,</span><span class="w"> </span><span class="nx">song</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="o">*</span><span class="nx">Playlist</span><span class="p">)</span><span class="w"> </span><span class="nf">PlayPlaylist</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">songs</span><span class="p">);</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Playing song: &#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">songs</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>This code looks simple and easy to read. But there&rsquo;s a huge problem: as we need to add more functionality like shuffle, filters, etc., this code will quickly become hard to maintain. Everytime we want to add a new feature or a way to iterate through the playlist, we&rsquo;ll need to modify the <code>PlayPlaylist()</code> method.</p>
<p>Let&rsquo;s say we need to add a shuffle Playlist feature, here&rsquo;s how we&rsquo;ll do it using the naive approach:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// Playlist represents a music playlist with songs.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">Playlist</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">songs</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// NewPlaylist creates and returns a new empty playlist.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="nf">NewPlaylist</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="nx">Playlist</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Playlist</span><span class="p">{</span><span class="nx">songs</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{}}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// AddSong adds a song to the playlist.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="o">*</span><span class="nx">Playlist</span><span class="p">)</span><span class="w"> </span><span class="nf">AddSong</span><span class="p">(</span><span class="nx">song</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">p</span><span class="p">.</span><span class="nx">songs</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">songs</span><span class="p">,</span><span class="w"> </span><span class="nx">song</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// PlayPlaylist plays all songs in order or shuffled.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="o">*</span><span class="nx">Playlist</span><span class="p">)</span><span class="w"> </span><span class="nf">PlayPlaylist</span><span class="p">(</span><span class="nx">shuffle</span><span class="w"> </span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">songs</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Playlist is empty.&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">return</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="nx">shuffle</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Shuffling playlist...&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">rand</span><span class="p">.</span><span class="nf">Seed</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">UnixNano</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">shuffled</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">songs</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nb">copy</span><span class="p">(</span><span class="nx">shuffled</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">songs</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">rand</span><span class="p">.</span><span class="nf">Shuffle</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">shuffled</span><span class="p">),</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="nx">shuffled</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span><span class="w"> </span><span class="nx">shuffled</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">shuffled</span><span class="p">[</span><span class="nx">j</span><span class="p">],</span><span class="w"> </span><span class="nx">shuffled</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="p">})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">song</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">shuffled</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Playing song:&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">song</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">song</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">songs</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Playing song:&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">song</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">playlist</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nf">NewPlaylist</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">playlist</span><span class="p">.</span><span class="nf">AddSong</span><span class="p">(</span><span class="s">&#34;Bohemian Rhapsody&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">playlist</span><span class="p">.</span><span class="nf">AddSong</span><span class="p">(</span><span class="s">&#34;Hotel California&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">playlist</span><span class="p">.</span><span class="nf">AddSong</span><span class="p">(</span><span class="s">&#34;Stairway to Heaven&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Playing in order:&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">playlist</span><span class="p">.</span><span class="nf">PlayPlaylist</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;\nPlaying shuffled:&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">playlist</span><span class="p">.</span><span class="nf">PlayPlaylist</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="how-iterator-design-pattern-solves-this">How Iterator Design pattern solves this<a hidden class="anchor" aria-hidden="true" href="#how-iterator-design-pattern-solves-this">#</a></h3>
<p>Let&rsquo;s take a look how we can use the iterator design pattern to tackle this problem:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">PlaylistIterator</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nf">HasNext</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nf">Next</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>Now we&rsquo;ll create three different iterators for different playlist types: Default playlist, Shuffled playlist, Liked Playlist.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">DefaultPlaylistIterator</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">playlist</span><span class="w"> </span><span class="nx">Playlist</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">index</span><span class="w"> </span><span class="kt">int</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="nf">NewDefaultPlaylistIterator</span><span class="p">(</span><span class="nx">playlist</span><span class="w"> </span><span class="nx">Playlist</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">DefaultPlaylistIterator</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">DefaultPlaylistIterator</span><span class="p">{</span><span class="nx">playlist</span><span class="p">:</span><span class="w"> </span><span class="nx">playlist</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">dp</span><span class="w"> </span><span class="o">*</span><span class="nx">DefaultPlaylistIterator</span><span class="p">)</span><span class="w"> </span><span class="nf">HasNext</span><span class="p">()</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">dp</span><span class="p">.</span><span class="nx">index</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">dp</span><span class="p">.</span><span class="nx">playlist</span><span class="p">.</span><span class="nx">songs</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">dp</span><span class="w"> </span><span class="o">*</span><span class="nx">DefaultPlaylistIterator</span><span class="p">)</span><span class="w"> </span><span class="nf">Next</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">dp</span><span class="p">.</span><span class="nx">playlist</span><span class="p">.</span><span class="nx">songs</span><span class="p">[</span><span class="nx">dp</span><span class="p">.</span><span class="nx">index</span><span class="o">++</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>Shuffled playlist:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// ShuffledPlaylistIterator iterates over the playlist in random order.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">ShuffledPlaylistIterator</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">playlist</span><span class="w"> </span><span class="nx">Playlist</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">index</span><span class="w">    </span><span class="kt">int</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">order</span><span class="w">    </span><span class="p">[]</span><span class="kt">int</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// NewShuffledPlaylistIterator creates a new shuffled iterator.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="nf">NewShuffledPlaylistIterator</span><span class="p">(</span><span class="nx">playlist</span><span class="w"> </span><span class="nx">Playlist</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">ShuffledPlaylistIterator</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">rand</span><span class="p">.</span><span class="nf">Seed</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">UnixNano</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">n</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">playlist</span><span class="p">.</span><span class="nx">songs</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">order</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">rand</span><span class="p">.</span><span class="nf">Perm</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="w"> </span><span class="c1">// generates a random permutation of indices</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">ShuffledPlaylistIterator</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">playlist</span><span class="p">:</span><span class="w"> </span><span class="nx">playlist</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">order</span><span class="p">:</span><span class="w">    </span><span class="nx">order</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">index</span><span class="p">:</span><span class="w">    </span><span class="mi">0</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">sp</span><span class="w"> </span><span class="o">*</span><span class="nx">ShuffledPlaylistIterator</span><span class="p">)</span><span class="w"> </span><span class="nf">HasNext</span><span class="p">()</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="nx">sp</span><span class="p">.</span><span class="nx">index</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">sp</span><span class="p">.</span><span class="nx">order</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">sp</span><span class="w"> </span><span class="o">*</span><span class="nx">ShuffledPlaylistIterator</span><span class="p">)</span><span class="w"> </span><span class="nf">Next</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">song</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sp</span><span class="p">.</span><span class="nx">playlist</span><span class="p">.</span><span class="nx">songs</span><span class="p">[</span><span class="nx">sp</span><span class="p">.</span><span class="nx">order</span><span class="p">[</span><span class="nx">sp</span><span class="p">.</span><span class="nx">index</span><span class="p">]]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">sp</span><span class="p">.</span><span class="nx">index</span><span class="o">++</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="nx">song</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>Liked Songs iterator:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// LikedPlaylistIterator iterates only over liked songs.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">LikedPlaylistIterator</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">playlist</span><span class="w"> </span><span class="nx">Playlist</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">index</span><span class="w">    </span><span class="kt">int</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">liked</span><span class="w">    </span><span class="p">[]</span><span class="kt">string</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// NewLikedPlaylistIterator creates a new iterator for liked songs only.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="nf">NewLikedPlaylistIterator</span><span class="p">(</span><span class="nx">playlist</span><span class="w"> </span><span class="nx">Playlist</span><span class="p">,</span><span class="w"> </span><span class="nx">likedSongs</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">LikedPlaylistIterator</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="kd">var</span><span class="w"> </span><span class="nx">liked</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">song</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">playlist</span><span class="p">.</span><span class="nx">songs</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="nx">likedSongs</span><span class="p">[</span><span class="nx">song</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="nx">liked</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">liked</span><span class="p">,</span><span class="w"> </span><span class="nx">song</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">LikedPlaylistIterator</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">playlist</span><span class="p">:</span><span class="w"> </span><span class="nx">playlist</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">liked</span><span class="p">:</span><span class="w">    </span><span class="nx">liked</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">index</span><span class="p">:</span><span class="w">    </span><span class="mi">0</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">lp</span><span class="w"> </span><span class="o">*</span><span class="nx">LikedPlaylistIterator</span><span class="p">)</span><span class="w"> </span><span class="nf">HasNext</span><span class="p">()</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="nx">lp</span><span class="p">.</span><span class="nx">index</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">lp</span><span class="p">.</span><span class="nx">liked</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">lp</span><span class="w"> </span><span class="o">*</span><span class="nx">LikedPlaylistIterator</span><span class="p">)</span><span class="w"> </span><span class="nf">Next</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">song</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">lp</span><span class="p">.</span><span class="nx">liked</span><span class="p">[</span><span class="nx">lp</span><span class="p">.</span><span class="nx">index</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">lp</span><span class="p">.</span><span class="nx">index</span><span class="o">++</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="nx">song</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>Here&rsquo;s how you would use these iterators in code:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">playlist</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Playlist</span><span class="p">{</span><span class="nx">songs</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;Bohemian Rhapsody&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;Hotel California&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;Stairway to Heaven&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;Imagine&#34;</span><span class="p">}}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="c1">// Default iterator</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Default Playlist:&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">def</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nf">NewDefaultPlaylistIterator</span><span class="p">(</span><span class="nx">playlist</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">for</span><span class="w"> </span><span class="nx">def</span><span class="p">.</span><span class="nf">HasNext</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">def</span><span class="p">.</span><span class="nf">Next</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="c1">// Shuffled iterator</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;\nShuffled Playlist:&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">shuf</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nf">NewShuffledPlaylistIterator</span><span class="p">(</span><span class="nx">playlist</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">for</span><span class="w"> </span><span class="nx">shuf</span><span class="p">.</span><span class="nf">HasNext</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">shuf</span><span class="p">.</span><span class="nf">Next</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="c1">// Liked iterator</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;\nLiked Playlist:&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">likedSongs</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">bool</span><span class="p">{</span><span class="s">&#34;Hotel California&#34;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;Imagine&#34;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">liked</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nf">NewLikedPlaylistIterator</span><span class="p">(</span><span class="nx">playlist</span><span class="p">,</span><span class="w"> </span><span class="nx">likedSongs</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">for</span><span class="w"> </span><span class="nx">liked</span><span class="p">.</span><span class="nf">HasNext</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">liked</span><span class="p">.</span><span class="nf">Next</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h2 id="mediator-design-pattern">Mediator Design Pattern<a hidden class="anchor" aria-hidden="true" href="#mediator-design-pattern">#</a></h2>
<p><img loading="lazy" src="/images/mediator.png" alt="Mediator Design Pattern"  />
</p>
<p>One of the key objectives of any design pattern is to avoidi tight coupling between objects. This can be done in many ways, as we have seen already.</p>
<p>One particularly effective method when the application grows a lot is the Mediator pattern. The Mediator pattern is the perfect example of a pattern that is commonly used by every programmer without thinking ver muich about it.</p>
<p>Mediator pattern will act as the type in charge of exchanging communication between two objects. This way, the communicating objects don&rsquo;t need to know each other and can change mor efreely.</p>
<h3 id="objectives">Objectives<a hidden class="anchor" aria-hidden="true" href="#objectives">#</a></h3>
<ul>
<li>To provide loose coupling between two objects that must communicate between them</li>
<li>To reduce the amount of dependencies of a particular type to the minimum by passing these needs to the Mediator pattern</li>
</ul>
<h3 id="example">Example<a hidden class="anchor" aria-hidden="true" href="#example">#</a></h3>
<p>Let&rsquo;s take the example of an auction system to showcase how this design pattern works.</p>
<h3 id="naive-approach">Naive approach<a hidden class="anchor" aria-hidden="true" href="#naive-approach">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">Bidder</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">bid</span><span class="w">  </span><span class="kt">int</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="nf">NewBidder</span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">Bidder</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Bidder</span><span class="p">{</span><span class="nx">name</span><span class="p">:</span><span class="w"> </span><span class="nx">name</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="o">*</span><span class="nx">Bidder</span><span class="p">)</span><span class="w"> </span><span class="nf">PlaceBid</span><span class="p">(</span><span class="nx">amount</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">bidders</span><span class="w"> </span><span class="p">[]</span><span class="o">*</span><span class="nx">Bidder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">b</span><span class="p">.</span><span class="nx">bid</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;%s placed a bid: %d\n&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">other</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">bidders</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="nx">other</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="nx">other</span><span class="p">.</span><span class="nf">ReceiveBid</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="o">*</span><span class="nx">Bidder</span><span class="p">)</span><span class="w"> </span><span class="nf">ReceiveBid</span><span class="p">(</span><span class="nx">bidder</span><span class="w"> </span><span class="o">*</span><span class="nx">Bidder</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;%s is notified: %s placed a bid of %d\n&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">bidder</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">bidder1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nf">NewBidder</span><span class="p">(</span><span class="s">&#34;Alice&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">bidder2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nf">NewBidder</span><span class="p">(</span><span class="s">&#34;Bob&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">bidder3</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nf">NewBidder</span><span class="p">(</span><span class="s">&#34;Charlie&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">bidders</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="o">*</span><span class="nx">Bidder</span><span class="p">{</span><span class="nx">bidder1</span><span class="p">,</span><span class="w"> </span><span class="nx">bidder2</span><span class="p">,</span><span class="w"> </span><span class="nx">bidder3</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">bidder1</span><span class="p">.</span><span class="nf">PlaceBid</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="nx">bidders</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">bidder2</span><span class="p">.</span><span class="nf">PlaceBid</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span><span class="w"> </span><span class="nx">bidders</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">bidder3</span><span class="p">.</span><span class="nf">PlaceBid</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="nx">bidders</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>Did you notice what&rsquo;s wrong in this? Every single bidder communicates <strong>directly</strong> with others, making it chaotic and tightly coupled.</p>
<p>Let&rsquo;s refactor with a mediator that coordinates all communications.</p>
<p>Step 1: Mediator interface</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">AuctionMediator</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nf">RegisterBidder</span><span class="p">(</span><span class="nx">bidder</span><span class="w"> </span><span class="o">*</span><span class="nx">Bidder</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nf">PlaceBid</span><span class="p">(</span><span class="nx">bidder</span><span class="w"> </span><span class="o">*</span><span class="nx">Bidder</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>Step 2: Concrete Mediator: AuctionHouse</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">AuctionHouse</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">bidders</span><span class="w"> </span><span class="p">[]</span><span class="o">*</span><span class="nx">Bidder</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="nf">NewAuctionHouse</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="nx">AuctionHouse</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">AuctionHouse</span><span class="p">{</span><span class="nx">bidders</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="o">*</span><span class="nx">Bidder</span><span class="p">{}}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="nx">AuctionHouse</span><span class="p">)</span><span class="w"> </span><span class="nf">RegisterBidder</span><span class="p">(</span><span class="nx">bidder</span><span class="w"> </span><span class="o">*</span><span class="nx">Bidder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">a</span><span class="p">.</span><span class="nx">bidders</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">bidders</span><span class="p">,</span><span class="w"> </span><span class="nx">bidder</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="nx">AuctionHouse</span><span class="p">)</span><span class="w"> </span><span class="nf">PlaceBid</span><span class="p">(</span><span class="nx">bidder</span><span class="w"> </span><span class="o">*</span><span class="nx">Bidder</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;%s placed a bid of %d\n&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">bidder</span><span class="p">.</span><span class="nf">GetName</span><span class="p">(),</span><span class="w"> </span><span class="nx">amount</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">other</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">bidders</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="nx">other</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">bidder</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="nx">other</span><span class="p">.</span><span class="nf">ReceiveBid</span><span class="p">(</span><span class="nx">bidder</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>Step 3: Updated Bidder class(Now it communicatesonly with the Mediator)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">Bidder</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">name</span><span class="w">     </span><span class="kt">string</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">mediator</span><span class="w"> </span><span class="nx">AuctionMediator</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="nf">NewBidder</span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">mediator</span><span class="w"> </span><span class="nx">AuctionMediator</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">Bidder</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Bidder</span><span class="p">{</span><span class="nx">name</span><span class="p">:</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">mediator</span><span class="p">:</span><span class="w"> </span><span class="nx">mediator</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="o">*</span><span class="nx">Bidder</span><span class="p">)</span><span class="w"> </span><span class="nf">GetName</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="o">*</span><span class="nx">Bidder</span><span class="p">)</span><span class="w"> </span><span class="nf">PlaceBid</span><span class="p">(</span><span class="nx">amount</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">b</span><span class="p">.</span><span class="nx">mediator</span><span class="p">.</span><span class="nf">PlaceBid</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="o">*</span><span class="nx">Bidder</span><span class="p">)</span><span class="w"> </span><span class="nf">ReceiveBid</span><span class="p">(</span><span class="nx">bidder</span><span class="w"> </span><span class="o">*</span><span class="nx">Bidder</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;%s is notified: %s placed a bid of %d\n&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">bidder</span><span class="p">.</span><span class="nf">GetName</span><span class="p">(),</span><span class="w"> </span><span class="nx">amount</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>Let&rsquo;s say we get a new feature request, i.e. to add logging and Bidding timer which enforces a bidding timeline. We don&rsquo;t want to modify the existing code.</p>
<p>But we can do a simple thing, just <em>extend</em> the existing <code>AuctionHouse</code> class</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">ExtendedAuctionHouse</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">AuctionHouse</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">biddingEndTime</span><span class="w"> </span><span class="kt">int64</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="nf">NewExtendedAuctionHouse</span><span class="p">(</span><span class="nx">duration</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">ExtendedAuctionHouse</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">ExtendedAuctionHouse</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">AuctionHouse</span><span class="p">:</span><span class="w">   </span><span class="o">*</span><span class="nf">NewAuctionHouse</span><span class="p">(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">biddingEndTime</span><span class="p">:</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">Add</span><span class="p">(</span><span class="nx">duration</span><span class="p">).</span><span class="nf">UnixMilli</span><span class="p">(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="nx">ExtendedAuctionHouse</span><span class="p">)</span><span class="w"> </span><span class="nf">PlaceBid</span><span class="p">(</span><span class="nx">bidder</span><span class="w"> </span><span class="o">*</span><span class="nx">Bidder</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">UnixMilli</span><span class="p">()</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">biddingEndTime</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Bidding time is over. No more bids accepted.&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">return</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;LOG: %s is bidding %d\n&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">bidder</span><span class="p">.</span><span class="nf">GetName</span><span class="p">(),</span><span class="w"> </span><span class="nx">amount</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">a</span><span class="p">.</span><span class="nx">AuctionHouse</span><span class="p">.</span><span class="nf">PlaceBid</span><span class="p">(</span><span class="nx">bidder</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>Step 5: Demo for Extended Mediator</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="c1">// Bidding window: 5 seconds</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">auctionHouse</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nf">NewExtendedAuctionHouse</span><span class="p">(</span><span class="mi">5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">bidder1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nf">NewBidder</span><span class="p">(</span><span class="s">&#34;Alice&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">auctionHouse</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">bidder2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nf">NewBidder</span><span class="p">(</span><span class="s">&#34;Bob&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">auctionHouse</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">bidder3</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nf">NewBidder</span><span class="p">(</span><span class="s">&#34;Charlie&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">auctionHouse</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">auctionHouse</span><span class="p">.</span><span class="nf">RegisterBidder</span><span class="p">(</span><span class="nx">bidder1</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">auctionHouse</span><span class="p">.</span><span class="nf">RegisterBidder</span><span class="p">(</span><span class="nx">bidder2</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">auctionHouse</span><span class="p">.</span><span class="nf">RegisterBidder</span><span class="p">(</span><span class="nx">bidder3</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">bidder1</span><span class="p">.</span><span class="nf">PlaceBid</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">time</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">bidder2</span><span class="p">.</span><span class="nf">PlaceBid</span><span class="p">(</span><span class="mi">150</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">time</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="mi">4</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span><span class="w"> </span><span class="c1">// exceeds bidding period</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">bidder3</span><span class="p">.</span><span class="nf">PlaceBid</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span><span class="w"> </span><span class="c1">// this one should be rejected</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="tldr">TLDR;<a hidden class="anchor" aria-hidden="true" href="#tldr">#</a></h3>
<table>
  <thead>
      <tr>
          <th>Concept</th>
          <th>Go Equivalent</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>AuctionMediator</code></td>
          <td>Interface defining communication contract</td>
      </tr>
      <tr>
          <td><code>AuctionHouse</code></td>
          <td>Concrete mediator coordinating bidders</td>
      </tr>
      <tr>
          <td><code>Bidder</code></td>
          <td>Concrete participant interacting via mediator</td>
      </tr>
      <tr>
          <td><code>ExtendedAuctionHouse</code></td>
          <td>Extended mediator adding logging &amp; timing logic</td>
      </tr>
  </tbody>
</table>
<h2 id="state-design-pattern">State Design Pattern<a hidden class="anchor" aria-hidden="true" href="#state-design-pattern">#</a></h2>
<p><img loading="lazy" src="/images/state.png" alt="Mediator Design Pattern"  />

You might have already guessed what this design pattern does, manages the state of an object. Just like a traffic light has different states(red, green, yellow) that determine its behavior, the State Design Pattern allows an object to alter its behavior when its internal state changes.
This pattern encapsulates state-specific behaviors into separate classes, promoting cleaner code anad better organisation.</p>
<h3 id="example-1">Example<a hidden class="anchor" aria-hidden="true" href="#example-1">#</a></h3>
<p>Let&rsquo;s take an example of a trafic light system, without using the State Design Pattern.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">TrafficLight</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">color</span><span class="w"> </span><span class="kt">string</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="nf">NewTrafficLight</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="nx">TrafficLight</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">TrafficLight</span><span class="p">{</span><span class="nx">color</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;RED&#34;</span><span class="p">}</span><span class="w"> </span><span class="c1">// start with red</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">TrafficLight</span><span class="p">)</span><span class="w"> </span><span class="nf">Next</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">switch</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">color</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">case</span><span class="w"> </span><span class="s">&#34;RED&#34;</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">t</span><span class="p">.</span><span class="nx">color</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#34;GREEN&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Light changed from RED to GREEN. Cars go!&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">case</span><span class="w"> </span><span class="s">&#34;GREEN&#34;</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">t</span><span class="p">.</span><span class="nx">color</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#34;YELLOW&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Light changed from GREEN to YELLOW. Slow down!&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">case</span><span class="w"> </span><span class="s">&#34;YELLOW&#34;</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">t</span><span class="p">.</span><span class="nx">color</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#34;RED&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Light changed from YELLOW to RED. Stop!&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">TrafficLight</span><span class="p">)</span><span class="w"> </span><span class="nf">GetColor</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">color</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>In this setup:</p>
<ul>
<li>The <code>TrafficLight</code> struct manages its state using a simple color string.</li>
<li>The <code>Next()</code> method uses switch case statements to transition between states.</li>
</ul>
<h3 id="when-things-get-ugly">When things get ugly<a hidden class="anchor" aria-hidden="true" href="#when-things-get-ugly">#</a></h3>
<p>Let&rsquo;s say we decide to add two more states: <code>BLINKING</code> and <code>MAINTENANCE</code>. Our <code>TrafficLight</code> struct starts to get messy with more switch cases.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">TrafficLight</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">color</span><span class="w"> </span><span class="kt">string</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="nf">NewTrafficLight</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="nx">TrafficLight</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">TrafficLight</span><span class="p">{</span><span class="nx">color</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;RED&#34;</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">TrafficLight</span><span class="p">)</span><span class="w"> </span><span class="nf">Next</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">switch</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">color</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">case</span><span class="w"> </span><span class="s">&#34;RED&#34;</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">t</span><span class="p">.</span><span class="nx">color</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#34;GREEN&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Change to GREEN. Cars go!&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">case</span><span class="w"> </span><span class="s">&#34;GREEN&#34;</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">t</span><span class="p">.</span><span class="nx">color</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#34;YELLOW&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Change to YELLOW. Slow down!&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">case</span><span class="w"> </span><span class="s">&#34;YELLOW&#34;</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">t</span><span class="p">.</span><span class="nx">color</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#34;RED&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Change to RED. Stop!&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">case</span><span class="w"> </span><span class="s">&#34;BLINKING&#34;</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">t</span><span class="p">.</span><span class="nx">color</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#34;MAINTENANCE&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Switching to MAINTENANCE mode...&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">case</span><span class="w"> </span><span class="s">&#34;MAINTENANCE&#34;</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">t</span><span class="p">.</span><span class="nx">color</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#34;RED&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Maintenance done, back to RED!&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">default</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Unknown state. Resetting to RED.&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">t</span><span class="p">.</span><span class="nx">color</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#34;RED&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">TrafficLight</span><span class="p">)</span><span class="w"> </span><span class="nf">GetColor</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">color</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="issues-with-this-naive-approach">Issues with this naive approach:<a hidden class="anchor" aria-hidden="true" href="#issues-with-this-naive-approach">#</a></h3>
<ol>
<li>Tight coupling</li>
<li>Scalabilityy problems</li>
<li>Maintenance Nightmare</li>
<li>Violation of Open/Close principles</li>
</ol>
<h3 id="state-design-pattern-to-the-rescue">State design pattern to the rescue<a hidden class="anchor" aria-hidden="true" href="#state-design-pattern-to-the-rescue">#</a></h3>
<h3 id="1-state-interface">1. State interface<a hidden class="anchor" aria-hidden="true" href="#1-state-interface">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">TrafficLightState</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nf">Next</span><span class="p">(</span><span class="nx">context</span><span class="w"> </span><span class="o">*</span><span class="nx">TrafficLightContext</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nf">GetColor</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="2-adding-concrete-states">2. Adding concrete states<a hidden class="anchor" aria-hidden="true" href="#2-adding-concrete-states">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// Concrete State: Red</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">RedState</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">RedState</span><span class="p">)</span><span class="w"> </span><span class="nf">Next</span><span class="p">(</span><span class="nx">context</span><span class="w"> </span><span class="o">*</span><span class="nx">TrafficLightContext</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Switching from RED to GREEN. Cars go!&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">context</span><span class="p">.</span><span class="nf">SetState</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">GreenState</span><span class="p">{})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">RedState</span><span class="p">)</span><span class="w"> </span><span class="nf">GetColor</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="s">&#34;RED&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// Concrete State: Green</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">GreenState</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">g</span><span class="w"> </span><span class="o">*</span><span class="nx">GreenState</span><span class="p">)</span><span class="w"> </span><span class="nf">Next</span><span class="p">(</span><span class="nx">context</span><span class="w"> </span><span class="o">*</span><span class="nx">TrafficLightContext</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Switching from GREEN to YELLOW. Slow down!&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">context</span><span class="p">.</span><span class="nf">SetState</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">YellowState</span><span class="p">{})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">g</span><span class="w"> </span><span class="o">*</span><span class="nx">GreenState</span><span class="p">)</span><span class="w"> </span><span class="nf">GetColor</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="s">&#34;GREEN&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// Concrete State: Yellow</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">YellowState</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="nx">YellowState</span><span class="p">)</span><span class="w"> </span><span class="nf">Next</span><span class="p">(</span><span class="nx">context</span><span class="w"> </span><span class="o">*</span><span class="nx">TrafficLightContext</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Switching from YELLOW to RED. Stop!&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">context</span><span class="p">.</span><span class="nf">SetState</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">RedState</span><span class="p">{})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">y</span><span class="w"> </span><span class="o">*</span><span class="nx">YellowState</span><span class="p">)</span><span class="w"> </span><span class="nf">GetColor</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="s">&#34;YELLOW&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="3-context-class">3. Context Class<a hidden class="anchor" aria-hidden="true" href="#3-context-class">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">TrafficLightContext</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">currentState</span><span class="w"> </span><span class="nx">TrafficLightState</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="nf">NewTrafficLightContext</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="nx">TrafficLightContext</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">TrafficLightContext</span><span class="p">{</span><span class="nx">currentState</span><span class="p">:</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">RedState</span><span class="p">{}}</span><span class="w"> </span><span class="c1">// start with RED</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">TrafficLightContext</span><span class="p">)</span><span class="w"> </span><span class="nf">SetState</span><span class="p">(</span><span class="nx">state</span><span class="w"> </span><span class="nx">TrafficLightState</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">t</span><span class="p">.</span><span class="nx">currentState</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">state</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">TrafficLightContext</span><span class="p">)</span><span class="w"> </span><span class="nf">Next</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">t</span><span class="p">.</span><span class="nx">currentState</span><span class="p">.</span><span class="nf">Next</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">TrafficLightContext</span><span class="p">)</span><span class="w"> </span><span class="nf">GetColor</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">currentState</span><span class="p">.</span><span class="nf">GetColor</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h2 id="chain-of-responsibility-design-pattern">Chain of Responsibility Design Pattern<a hidden class="anchor" aria-hidden="true" href="#chain-of-responsibility-design-pattern">#</a></h2>
<p><img loading="lazy" src="/images/chain_responsibility.png" alt="Mediator Design Pattern"  />

As its name implies, it consists of a chain and, in our case, each link of the chain follows the single responsiility principle.</p>
<p>This pattern implies that a type, function, method, or any similar abstraction must have one single responsiility only and it must do it quite well. This way, we can apply many functions that achieve one specifict thing each to some struct, slice, map and so on.</p>
<p>But also, we could have a chain of checks and, in case one of them fails, break the chain and return something. This is the authentication and authorization middleware works.</p>
<p>Let&rsquo;s take the example of the process of leave processing in a corporate hierarchy.</p>
<h3 id="naive-approach-1">Naive approach<a hidden class="anchor" aria-hidden="true" href="#naive-approach-1">#</a></h3>
<p>This is how the naive approach would look like:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">LeaveRequestNaive</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">leaveDays</span><span class="w"> </span><span class="kt">int</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="nf">NewLeaveRequest</span><span class="p">(</span><span class="nx">leaveDays</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">LeaveRequestNaive</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">LeaveRequestNaive</span><span class="p">{</span><span class="nx">leaveDays</span><span class="p">:</span><span class="w"> </span><span class="nx">leaveDays</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="p">(</span><span class="nx">lr</span><span class="w"> </span><span class="o">*</span><span class="nx">LeaveRequestNaive</span><span class="p">)</span><span class="w"> </span><span class="nf">ProcessLeave</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">lr</span><span class="p">.</span><span class="nx">leaveDays</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Supervisor approved the leave&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">lr</span><span class="p">.</span><span class="nx">leaveDays</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Manager approved the leave&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">lr</span><span class="p">.</span><span class="nx">leaveDays</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Director approved the leave&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Leave request denied. Too many days!&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>You see what&rsquo;s wrong in this right? Harder to maintain, non-scalable, messy, hard to extend, unreadable when the conditions get more stricter.
This is where Chain of Responsibility Design pattern comes in.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// Approver defines the handler interface in the chain</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">Approver</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nf">SetNext</span><span class="p">(</span><span class="nx">Approver</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nf">ProcessLeaveRequest</span><span class="p">(</span><span class="nx">leaveDays</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><ul>
<li>Concrete handlers</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// Base struct that other handlers will embed</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">BaseApprover</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">next</span><span class="w"> </span><span class="nx">Approver</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="o">*</span><span class="nx">BaseApprover</span><span class="p">)</span><span class="w"> </span><span class="nf">SetNext</span><span class="p">(</span><span class="nx">next</span><span class="w"> </span><span class="nx">Approver</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">b</span><span class="p">.</span><span class="nx">next</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">next</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// Concrete Handler: Supervisor</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">Supervisor</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">BaseApprover</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="nx">Supervisor</span><span class="p">)</span><span class="w"> </span><span class="nf">ProcessLeaveRequest</span><span class="p">(</span><span class="nx">leaveDays</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="nx">leaveDays</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Supervisor approved the leave.&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">next</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">s</span><span class="p">.</span><span class="nx">next</span><span class="p">.</span><span class="nf">ProcessLeaveRequest</span><span class="p">(</span><span class="nx">leaveDays</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// Concrete Handler: Manager</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">Manager</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">BaseApprover</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">m</span><span class="w"> </span><span class="o">*</span><span class="nx">Manager</span><span class="p">)</span><span class="w"> </span><span class="nf">ProcessLeaveRequest</span><span class="p">(</span><span class="nx">leaveDays</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="nx">leaveDays</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Manager approved the leave.&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">next</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">m</span><span class="p">.</span><span class="nx">next</span><span class="p">.</span><span class="nf">ProcessLeaveRequest</span><span class="p">(</span><span class="nx">leaveDays</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// Concrete Handler: Director</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">Director</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">BaseApprover</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="o">*</span><span class="nx">Director</span><span class="p">)</span><span class="w"> </span><span class="nf">ProcessLeaveRequest</span><span class="p">(</span><span class="nx">leaveDays</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="nx">leaveDays</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Director approved the leave.&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">next</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">d</span><span class="p">.</span><span class="nx">next</span><span class="p">.</span><span class="nf">ProcessLeaveRequest</span><span class="p">(</span><span class="nx">leaveDays</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Leave request denied. Too many days!&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><ul>
<li>Setting up the chain</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="c1">// Create handler instances</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">supervisor</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Supervisor</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">manager</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Manager</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">director</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Director</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="c1">// Set up the chain: Supervisor -&gt; Manager -&gt; Director</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">supervisor</span><span class="p">.</span><span class="nf">SetNext</span><span class="p">(</span><span class="nx">manager</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">manager</span><span class="p">.</span><span class="nf">SetNext</span><span class="p">(</span><span class="nx">director</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="c1">// Process a leave request</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">leaveDays</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;Employee requests %d days of leave.\n&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">leaveDays</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">supervisor</span><span class="p">.</span><span class="nf">ProcessLeaveRequest</span><span class="p">(</span><span class="nx">leaveDays</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="benefits-of-chain-responsiility-pattern">Benefits of Chain responsiility pattern<a hidden class="anchor" aria-hidden="true" href="#benefits-of-chain-responsiility-pattern">#</a></h3>
<ul>
<li>Loose coupling between sender and handler</li>
<li>Enhanced flexibility &amp; scalability</li>
<li>Improved code organisation &amp; maintainability</li>
<li>Reusability of Handlers</li>
<li>Dynamic Request Handling</li>
</ul>
<h2 id="visitor-design-pattern">Visitor Design Pattern<a hidden class="anchor" aria-hidden="true" href="#visitor-design-pattern">#</a></h2>
<p><img loading="lazy" src="/images/visitor.png" alt="Visitor Design Pattern "  />
</p>
<p>Imagine you‚Äôre running a hospital.
You‚Äôve got child, adult, and senior patients.
Every time a doctor or accountant comes in, they perform different operations ‚Äî diagnosis, billing, etc.</p>
<p>Now here‚Äôs the problem:
Every time you introduce a new operation (say, insurance claim processing), you have to modify every single patient type.
That‚Äôs not scalable, and it breaks the Open-Closed Principle ‚Äî your classes should be open for extension but closed for modification.</p>
<p>This is where the Visitor Design Pattern steps in ‚Äî allowing you to add new operations without changing the existing structure of your objects.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">ChildPatient</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">ChildPatient</span><span class="p">)</span><span class="w"> </span><span class="nf">Diagnosis</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Diagnosing a child patient.&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">ChildPatient</span><span class="p">)</span><span class="w"> </span><span class="nf">Billing</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Calculating billing for a child patient.&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">AdultPatient</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="nx">AdultPatient</span><span class="p">)</span><span class="w"> </span><span class="nf">Diagnosis</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Diagnosing an adult patient.&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="nx">AdultPatient</span><span class="p">)</span><span class="w"> </span><span class="nf">Billing</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Calculating billing for an adult patient.&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">SeniorPatient</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="nx">SeniorPatient</span><span class="p">)</span><span class="w"> </span><span class="nf">Diagnosis</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Diagnosing a senior patient.&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="nx">SeniorPatient</span><span class="p">)</span><span class="w"> </span><span class="nf">Billing</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Calculating billing for a senior patient.&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="c1">// patient could be of any type</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="kd">var</span><span class="w"> </span><span class="nx">patient</span><span class="w"> </span><span class="kd">interface</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">patient</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">AdultPatient</span><span class="p">{}</span><span class="w"> </span><span class="c1">// could also be &amp;ChildPatient{} or &amp;SeniorPatient{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="c1">// Using type checks (like Java&#39;s instanceof)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">switch</span><span class="w"> </span><span class="nx">p</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">patient</span><span class="p">.(</span><span class="kd">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">case</span><span class="w"> </span><span class="o">*</span><span class="nx">ChildPatient</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">p</span><span class="p">.</span><span class="nf">Diagnosis</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">p</span><span class="p">.</span><span class="nf">Billing</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">case</span><span class="w"> </span><span class="o">*</span><span class="nx">AdultPatient</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">p</span><span class="p">.</span><span class="nf">Diagnosis</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">p</span><span class="p">.</span><span class="nf">Billing</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">case</span><span class="w"> </span><span class="o">*</span><span class="nx">SeniorPatient</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">p</span><span class="p">.</span><span class="nf">Diagnosis</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">p</span><span class="p">.</span><span class="nf">Billing</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">default</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Unknown patient type.&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="whats-wrong-here">What&rsquo;s wrong here?<a hidden class="anchor" aria-hidden="true" href="#whats-wrong-here">#</a></h3>
<ul>
<li>
<p>Every time you add a new operation (like ‚ÄúInsuranceClaim‚Äù), you must edit each patient type.</p>
</li>
<li>
<p>You‚Äôre relying on a big, ugly switch statement.</p>
</li>
<li>
<p>Violates Open-Closed Principle ‚Äî the code is hard to extend.</p>
</li>
</ul>
<p>Let‚Äôs fix this with the Visitor pattern.</p>
<h3 id="step-1-define-the-patient-interface">Step 1: Define the <code>Patient</code> interface<a hidden class="anchor" aria-hidden="true" href="#step-1-define-the-patient-interface">#</a></h3>
<p>We‚Äôll start by defining two key interfaces:</p>
<ul>
<li>
<p><code>Patient</code>: represents elements (like child, adult, senior).</p>
</li>
<li>
<p><code>visitor</code>: represents operations to be performed on them.</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">Visitor</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nf">VisitChildPatient</span><span class="p">(</span><span class="o">*</span><span class="nx">ChildPatient</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nf">VisitAdultPatient</span><span class="p">(</span><span class="o">*</span><span class="nx">AdultPatient</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nf">VisitSeniorPatient</span><span class="p">(</span><span class="o">*</span><span class="nx">SeniorPatient</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">Patient</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nf">Accept</span><span class="p">(</span><span class="nx">visitor</span><span class="w"> </span><span class="nx">Visitor</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="step-2-concrete-patient-types">Step 2: Concrete Patient Types<a hidden class="anchor" aria-hidden="true" href="#step-2-concrete-patient-types">#</a></h3>
<p>Each patient type implements <code>Accept()</code>, which simply calls the right visitor method.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">ChildPatient</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">ChildPatient</span><span class="p">)</span><span class="w"> </span><span class="nf">Accept</span><span class="p">(</span><span class="nx">visitor</span><span class="w"> </span><span class="nx">Visitor</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">visitor</span><span class="p">.</span><span class="nf">VisitChildPatient</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">AdultPatient</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="nx">AdultPatient</span><span class="p">)</span><span class="w"> </span><span class="nf">Accept</span><span class="p">(</span><span class="nx">visitor</span><span class="w"> </span><span class="nx">Visitor</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">visitor</span><span class="p">.</span><span class="nf">VisitAdultPatient</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">SeniorPatient</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="nx">SeniorPatient</span><span class="p">)</span><span class="w"> </span><span class="nf">Accept</span><span class="p">(</span><span class="nx">visitor</span><span class="w"> </span><span class="nx">Visitor</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">visitor</span><span class="p">.</span><span class="nf">VisitSeniorPatient</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>This may look small, but it‚Äôs powerful.
Now, the patients don‚Äôt need to know what kind of operation is being performed ‚Äî they just accept a visitor, and the visitor decides what to do.</p>
<h3 id="step-3-define-the-visitor-interface">Step 3: Define the Visitor Interface<a hidden class="anchor" aria-hidden="true" href="#step-3-define-the-visitor-interface">#</a></h3>
<p>The visitor defines the operations that can be performed on each patient type.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">Visitor</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nf">VisitChildPatient</span><span class="p">(</span><span class="o">*</span><span class="nx">ChildPatient</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nf">VisitAdultPatient</span><span class="p">(</span><span class="o">*</span><span class="nx">AdultPatient</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nf">VisitSeniorPatient</span><span class="p">(</span><span class="o">*</span><span class="nx">SeniorPatient</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="step-4-create-concrete-visitors">Step 4: Create Concrete Visitors<a hidden class="anchor" aria-hidden="true" href="#step-4-create-concrete-visitors">#</a></h3>
<p>Now let‚Äôs create our first visitor: <code>DiagnosisVisitor</code>, which performs diagnosis for each patient.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">DiagnosisVisitor</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="o">*</span><span class="nx">DiagnosisVisitor</span><span class="p">)</span><span class="w"> </span><span class="nf">VisitChildPatient</span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">ChildPatient</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Diagnosing a child patient: Check-up and pediatric care.&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="o">*</span><span class="nx">DiagnosisVisitor</span><span class="p">)</span><span class="w"> </span><span class="nf">VisitAdultPatient</span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="nx">AdultPatient</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Diagnosing an adult patient: Routine exams and lifestyle advice.&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="o">*</span><span class="nx">DiagnosisVisitor</span><span class="p">)</span><span class="w"> </span><span class="nf">VisitSeniorPatient</span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="nx">SeniorPatient</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Diagnosing a senior patient: Comprehensive geriatric evaluation.&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="billing-visitor">Billing Visitor<a hidden class="anchor" aria-hidden="true" href="#billing-visitor">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">BillingVisitor</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="o">*</span><span class="nx">BillingVisitor</span><span class="p">)</span><span class="w"> </span><span class="nf">VisitChildPatient</span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">ChildPatient</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Calculating billing for a child patient.&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="o">*</span><span class="nx">BillingVisitor</span><span class="p">)</span><span class="w"> </span><span class="nf">VisitAdultPatient</span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="nx">AdultPatient</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Calculating billing for an adult patient.&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="o">*</span><span class="nx">BillingVisitor</span><span class="p">)</span><span class="w"> </span><span class="nf">VisitSeniorPatient</span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="nx">SeniorPatient</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Calculating billing for a senior patient.&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="stitching-it-all-together">Stitching it all together<a hidden class="anchor" aria-hidden="true" href="#stitching-it-all-together">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">patients</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="nx">Patient</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="o">&amp;</span><span class="nx">ChildPatient</span><span class="p">{},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="o">&amp;</span><span class="nx">AdultPatient</span><span class="p">{},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="o">&amp;</span><span class="nx">SeniorPatient</span><span class="p">{},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">diagnosisVisitor</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">DiagnosisVisitor</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">billingVisitor</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">BillingVisitor</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">patient</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">patients</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">patient</span><span class="p">.</span><span class="nf">Accept</span><span class="p">(</span><span class="nx">diagnosisVisitor</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">patient</span><span class="p">.</span><span class="nf">Accept</span><span class="p">(</span><span class="nx">billingVisitor</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="what-just-happened">What Just Happened?<a hidden class="anchor" aria-hidden="true" href="#what-just-happened">#</a></h3>
<ul>
<li>
<p>Each Patient knows how to accept a visitor, but doesn‚Äôt know what the visitor will do.</p>
</li>
<li>
<p>Each Visitor defines a specific operation (diagnosis, billing, etc.) for every patient type.</p>
</li>
<li>
<p>Adding a new operation (say, ‚ÄúInsuranceClaimVisitor‚Äù) doesn‚Äôt require changing the patient classes ‚Äî just add a new visitor!</p>
</li>
</ul>
<p>That‚Äôs pure elegance ‚Äî and total separation of concerns.</p>
<h2 id="memento-design-pattern">Memento Design Pattern<a hidden class="anchor" aria-hidden="true" href="#memento-design-pattern">#</a></h2>
<p><img loading="lazy" src="/images/memento.png" alt="Memento Design Pattern"  />
</p>
<p>The Memento Pattern is like a memory capsule. It lets an object remember its previous state ‚Äî just like you might save drafts or snapshots before making big changes.</p>
<p>Think of it as your app‚Äôs ‚Äúundo‚Äù button ‚Äî you take a snapshot (a memento) before making changes, and if things go wrong, you can roll back to the previous version.</p>
<h3 id="example-text-editor-with-edit-feature">Example: Text Editor with Edit feature<a hidden class="anchor" aria-hidden="true" href="#example-text-editor-with-edit-feature">#</a></h3>
<p>Imagine a simple text editor. A user types something, edits it, and sometimes ‚Äî oops ‚Äî wants to undo the last change.</p>
<p>You could just manually save the text before each change, but that approach quickly becomes messy.</p>
<h3 id="naive-approach-2">Naive approach<a hidden class="anchor" aria-hidden="true" href="#naive-approach-2">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">TextEditorTraditional</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">text</span><span class="w"> </span><span class="kt">string</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="nf">NewTextEditorTraditional</span><span class="p">(</span><span class="nx">text</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">TextEditorTraditional</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">TextEditorTraditional</span><span class="p">{</span><span class="nx">text</span><span class="p">:</span><span class="w"> </span><span class="nx">text</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">TextEditorTraditional</span><span class="p">)</span><span class="w"> </span><span class="nf">SetText</span><span class="p">(</span><span class="nx">newText</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">t</span><span class="p">.</span><span class="nx">text</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">newText</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">TextEditorTraditional</span><span class="p">)</span><span class="w"> </span><span class="nf">Undo</span><span class="p">(</span><span class="nx">previousState</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">t</span><span class="p">.</span><span class="nx">text</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">previousState</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">TextEditorTraditional</span><span class="p">)</span><span class="w"> </span><span class="nf">ShowText</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Current text:&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">text</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">editor</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nf">NewTextEditorTraditional</span><span class="p">(</span><span class="s">&#34;Hello&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">editor</span><span class="p">.</span><span class="nf">ShowText</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="c1">// Manual backup</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">backup</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">editor</span><span class="p">.</span><span class="nx">text</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">editor</span><span class="p">.</span><span class="nf">SetText</span><span class="p">(</span><span class="s">&#34;Hello, World!&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">editor</span><span class="p">.</span><span class="nf">ShowText</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="c1">// Undo using manual backup</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">editor</span><span class="p">.</span><span class="nf">Undo</span><span class="p">(</span><span class="nx">backup</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">editor</span><span class="p">.</span><span class="nf">ShowText</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="whats-wrong-here-1">What&rsquo;s wrong here?<a hidden class="anchor" aria-hidden="true" href="#whats-wrong-here-1">#</a></h3>
<ul>
<li>
<p>You‚Äôre manually managing state (bad idea for scalability).</p>
</li>
<li>
<p>Adding multiple undo levels will quickly lead to cluttered, repetitive logic.</p>
</li>
</ul>
<h3 id="when-things-go-messy">When things go messy<a hidden class="anchor" aria-hidden="true" href="#when-things-go-messy">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">TextEditorUgly</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">text</span><span class="w">    </span><span class="kt">string</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">backup1</span><span class="w"> </span><span class="kt">string</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">backup2</span><span class="w"> </span><span class="kt">string</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">TextEditorUgly</span><span class="p">)</span><span class="w"> </span><span class="nf">SetText</span><span class="p">(</span><span class="nx">newText</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="c1">// Manual backup juggling</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">t</span><span class="p">.</span><span class="nx">backup2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">backup1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">t</span><span class="p">.</span><span class="nx">backup1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">text</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">t</span><span class="p">.</span><span class="nx">text</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">newText</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">TextEditorUgly</span><span class="p">)</span><span class="w"> </span><span class="nf">Undo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">t</span><span class="p">.</span><span class="nx">text</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">backup1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">TextEditorUgly</span><span class="p">)</span><span class="w"> </span><span class="nf">ShowText</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Current text:&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">text</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="how-memento-pattern-saves-the-day">How Memento pattern saves the day<a hidden class="anchor" aria-hidden="true" href="#how-memento-pattern-saves-the-day">#</a></h3>
<p>The Memento Pattern solves this neatly by separating state storage from business logic.</p>
<ol>
<li>
<p>We‚Äôll break this into three parts:</p>
</li>
<li>
<p>Originator ‚Äî The text editor itself.</p>
</li>
<li>
<p>Memento ‚Äî A snapshot of the editor‚Äôs state.</p>
</li>
</ol>
<p>Caretaker ‚Äî A history manager that stores past states.</p>
<p>Step 1: The Originator</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">TextEditor</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">text</span><span class="w"> </span><span class="kt">string</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">TextEditor</span><span class="p">)</span><span class="w"> </span><span class="nf">SetText</span><span class="p">(</span><span class="nx">newText</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">t</span><span class="p">.</span><span class="nx">text</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">newText</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">TextEditor</span><span class="p">)</span><span class="w"> </span><span class="nf">GetText</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">text</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// Save creates a memento (snapshot) of the current state</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">TextEditor</span><span class="p">)</span><span class="w"> </span><span class="nf">Save</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="nx">Memento</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Memento</span><span class="p">{</span><span class="nx">text</span><span class="p">:</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">text</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// Restore reverts to a given memento</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">TextEditor</span><span class="p">)</span><span class="w"> </span><span class="nf">Restore</span><span class="p">(</span><span class="nx">m</span><span class="w"> </span><span class="o">*</span><span class="nx">Memento</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">t</span><span class="p">.</span><span class="nx">text</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">text</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>Step 2: The Memento</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">Memento</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">text</span><span class="w"> </span><span class="kt">string</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">m</span><span class="w"> </span><span class="o">*</span><span class="nx">Memento</span><span class="p">)</span><span class="w"> </span><span class="nf">GetText</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">text</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>Step 3: History Manager</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">Memento</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">text</span><span class="w"> </span><span class="kt">string</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">m</span><span class="w"> </span><span class="o">*</span><span class="nx">Memento</span><span class="p">)</span><span class="w"> </span><span class="nf">GetText</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">text</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>Step 4: Stitching it all together</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">editor</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">TextEditor</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">history</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">EditorHistory</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">editor</span><span class="p">.</span><span class="nf">SetText</span><span class="p">(</span><span class="s">&#34;Hello&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Current text:&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">editor</span><span class="p">.</span><span class="nf">GetText</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">history</span><span class="p">.</span><span class="nf">Push</span><span class="p">(</span><span class="nx">editor</span><span class="p">.</span><span class="nf">Save</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">editor</span><span class="p">.</span><span class="nf">SetText</span><span class="p">(</span><span class="s">&#34;Hello, World!&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Current text:&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">editor</span><span class="p">.</span><span class="nf">GetText</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">history</span><span class="p">.</span><span class="nf">Push</span><span class="p">(</span><span class="nx">editor</span><span class="p">.</span><span class="nf">Save</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">editor</span><span class="p">.</span><span class="nf">SetText</span><span class="p">(</span><span class="s">&#34;Hello, World! Welcome to Go Memento Pattern.&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Current text:&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">editor</span><span class="p">.</span><span class="nf">GetText</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="c1">// Undo once</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">prev</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">history</span><span class="p">.</span><span class="nf">Pop</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="nx">prev</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">editor</span><span class="p">.</span><span class="nf">Restore</span><span class="p">(</span><span class="nx">prev</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;After undo:&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">editor</span><span class="p">.</span><span class="nf">GetText</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="c1">// Undo again</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">prev</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">history</span><span class="p">.</span><span class="nf">Pop</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="nx">prev</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">editor</span><span class="p">.</span><span class="nf">Restore</span><span class="p">(</span><span class="nx">prev</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;After second undo:&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">editor</span><span class="p">.</span><span class="nf">GetText</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="advantages">Advantages<a hidden class="anchor" aria-hidden="true" href="#advantages">#</a></h3>
<ul>
<li>Encapsulated State ‚Äî Keeps internal state private and safe.</li>
<li>Simplified Undo/Redo ‚Äî Perfect for rollback or version control.</li>
<li>Separation of Concerns ‚Äî Originator handles logic, Caretaker manages history.</li>
<li>Easy Recovery ‚Äî Revert to any previous state effortlessly.</li>
</ul>
<h2 id="command-design-pattern">Command Design Pattern<a hidden class="anchor" aria-hidden="true" href="#command-design-pattern">#</a></h2>
<p><img loading="lazy" src="/images/command.png" alt="Command Desigin Pattern"  />
</p>
<h3 id="what-problem-does-it-solve">What Problem Does It Solve?<a hidden class="anchor" aria-hidden="true" href="#what-problem-does-it-solve">#</a></h3>
<p>Imagine you&rsquo;re building a remote control app for a smart home.
You have devices like lights, fans, and stereos ‚Äî each with different actions.</p>
<p>Without the Command Pattern, your controller might directly call device functions like:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">light</span><span class="p">.</span><span class="nf">On</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="nx">light</span><span class="p">.</span><span class="nf">Off</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="nx">fan</span><span class="p">.</span><span class="nf">Start</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="nx">fan</span><span class="p">.</span><span class="nf">Stop</span><span class="p">()</span><span class="w">
</span></span></span></code></pre></div><p>That works‚Ä¶ until it doesn&rsquo;t.</p>
<p>What if:</p>
<ul>
<li>You want to add undo functionality?</li>
<li>You want to queue commands?</li>
<li>You want to trigger macros (like &ldquo;Good Night&rdquo; turns off everything)?</li>
</ul>
<p>Your code becomes a tangled mess of conditionals and direct method calls.
The Command Pattern cleans this up by decoupling the invoker (remote) from the receiver (devices).</p>
<p>Let&rsquo;s build our smart home remote system the right way ‚Äî using the Command Design Pattern.</p>
<h3 id="step-1-define-the-command-interface">Step 1: Define the Command Interface<a hidden class="anchor" aria-hidden="true" href="#step-1-define-the-command-interface">#</a></h3>
<p>Every command should have a common method ‚Äî typically Execute() and maybe Undo().</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="nx">main</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="s">&#34;fmt&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">Command</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nf">Execute</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nf">Undo</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>This allows our remote to handle any command without knowing what it does internally.</p>
<h3 id="step-2-create-receiver-classes-actual-devices">Step 2: Create Receiver Classes (Actual Devices)<a hidden class="anchor" aria-hidden="true" href="#step-2-create-receiver-classes-actual-devices">#</a></h3>
<p>Let&rsquo;s create a Light and a Fan to simulate our smart devices.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">Light</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">isOn</span><span class="w"> </span><span class="kt">bool</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">l</span><span class="w"> </span><span class="o">*</span><span class="nx">Light</span><span class="p">)</span><span class="w"> </span><span class="nf">On</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">l</span><span class="p">.</span><span class="nx">isOn</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Light is ON&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">l</span><span class="w"> </span><span class="o">*</span><span class="nx">Light</span><span class="p">)</span><span class="w"> </span><span class="nf">Off</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">l</span><span class="p">.</span><span class="nx">isOn</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Light is OFF&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">Fan</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">isRunning</span><span class="w"> </span><span class="kt">bool</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">f</span><span class="w"> </span><span class="o">*</span><span class="nx">Fan</span><span class="p">)</span><span class="w"> </span><span class="nf">Start</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">f</span><span class="p">.</span><span class="nx">isRunning</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Fan is RUNNING&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">f</span><span class="w"> </span><span class="o">*</span><span class="nx">Fan</span><span class="p">)</span><span class="w"> </span><span class="nf">Stop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">f</span><span class="p">.</span><span class="nx">isRunning</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Fan is STOPPED&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>These are the receivers ‚Äî they know how to perform actual work.</p>
<h3 id="step-3-concrete-command-implementations">Step 3: Concrete Command Implementations<a hidden class="anchor" aria-hidden="true" href="#step-3-concrete-command-implementations">#</a></h3>
<p>Now we&rsquo;ll create command structs that wrap these actions.</p>
<p>Each command knows its receiver and implements the Execute() and Undo() methods.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// Light Commands</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">LightOnCommand</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">light</span><span class="w"> </span><span class="o">*</span><span class="nx">Light</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">LightOnCommand</span><span class="p">)</span><span class="w"> </span><span class="nf">Execute</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">c</span><span class="p">.</span><span class="nx">light</span><span class="p">.</span><span class="nf">On</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">LightOnCommand</span><span class="p">)</span><span class="w"> </span><span class="nf">Undo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">c</span><span class="p">.</span><span class="nx">light</span><span class="p">.</span><span class="nf">Off</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">LightOffCommand</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">light</span><span class="w"> </span><span class="o">*</span><span class="nx">Light</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">LightOffCommand</span><span class="p">)</span><span class="w"> </span><span class="nf">Execute</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">c</span><span class="p">.</span><span class="nx">light</span><span class="p">.</span><span class="nf">Off</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">LightOffCommand</span><span class="p">)</span><span class="w"> </span><span class="nf">Undo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">c</span><span class="p">.</span><span class="nx">light</span><span class="p">.</span><span class="nf">On</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// Fan Commands</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">FanStartCommand</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fan</span><span class="w"> </span><span class="o">*</span><span class="nx">Fan</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">FanStartCommand</span><span class="p">)</span><span class="w"> </span><span class="nf">Execute</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">c</span><span class="p">.</span><span class="nx">fan</span><span class="p">.</span><span class="nf">Start</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">FanStartCommand</span><span class="p">)</span><span class="w"> </span><span class="nf">Undo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">c</span><span class="p">.</span><span class="nx">fan</span><span class="p">.</span><span class="nf">Stop</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">FanStopCommand</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fan</span><span class="w"> </span><span class="o">*</span><span class="nx">Fan</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">FanStopCommand</span><span class="p">)</span><span class="w"> </span><span class="nf">Execute</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">c</span><span class="p">.</span><span class="nx">fan</span><span class="p">.</span><span class="nf">Stop</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">FanStopCommand</span><span class="p">)</span><span class="w"> </span><span class="nf">Undo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">c</span><span class="p">.</span><span class="nx">fan</span><span class="p">.</span><span class="nf">Start</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>Each command object now encapsulates an action and knows how to both do and undo it.</p>
<h3 id="step-4-the-invoker--the-remote-control">Step 4: The Invoker ‚Äì The Remote Control<a hidden class="anchor" aria-hidden="true" href="#step-4-the-invoker--the-remote-control">#</a></h3>
<p>The invoker doesn&rsquo;t know what commands do.
It just calls Execute() and Undo() when buttons are pressed.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">RemoteControl</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">history</span><span class="w"> </span><span class="p">[]</span><span class="nx">Command</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">RemoteControl</span><span class="p">)</span><span class="w"> </span><span class="nf">PressButton</span><span class="p">(</span><span class="nx">cmd</span><span class="w"> </span><span class="nx">Command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">cmd</span><span class="p">.</span><span class="nf">Execute</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">r</span><span class="p">.</span><span class="nx">history</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">history</span><span class="p">,</span><span class="w"> </span><span class="nx">cmd</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">RemoteControl</span><span class="p">)</span><span class="w"> </span><span class="nf">PressUndo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">history</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Nothing to undo.&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">return</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">last</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">history</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">history</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">r</span><span class="p">.</span><span class="nx">history</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">history</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">history</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">last</span><span class="p">.</span><span class="nf">Undo</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>The RemoteControl acts as our Invoker ‚Äî managing the lifecycle of commands and allowing undo functionality.</p>
<h3 id="step-5-putting-it-all-together">Step 5: Putting It All Together<a hidden class="anchor" aria-hidden="true" href="#step-5-putting-it-all-together">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">light</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Light</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fan</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Fan</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">remote</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">RemoteControl</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">lightOn</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">LightOnCommand</span><span class="p">{</span><span class="nx">light</span><span class="p">:</span><span class="w"> </span><span class="nx">light</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fanStart</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">FanStartCommand</span><span class="p">{</span><span class="nx">fan</span><span class="p">:</span><span class="w"> </span><span class="nx">fan</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">lightOff</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">LightOffCommand</span><span class="p">{</span><span class="nx">light</span><span class="p">:</span><span class="w"> </span><span class="nx">light</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fanStop</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">FanStopCommand</span><span class="p">{</span><span class="nx">fan</span><span class="p">:</span><span class="w"> </span><span class="nx">fan</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="c1">// Execute some commands</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">remote</span><span class="p">.</span><span class="nf">PressButton</span><span class="p">(</span><span class="nx">lightOn</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">remote</span><span class="p">.</span><span class="nf">PressButton</span><span class="p">(</span><span class="nx">fanStart</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">remote</span><span class="p">.</span><span class="nf">PressButton</span><span class="p">(</span><span class="nx">lightOff</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">remote</span><span class="p">.</span><span class="nf">PressButton</span><span class="p">(</span><span class="nx">fanStop</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="c1">// Undo last two commands</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">remote</span><span class="p">.</span><span class="nf">PressUndo</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">remote</span><span class="p">.</span><span class="nf">PressUndo</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="why-this-pattern-rocks">Why This Pattern Rocks<a hidden class="anchor" aria-hidden="true" href="#why-this-pattern-rocks">#</a></h3>
<ul>
<li><strong>Decouples senders from receivers</strong> ‚Äî The remote doesn&rsquo;t need to know how a device works.</li>
<li><strong>Easily extendable</strong> ‚Äî Add new devices and commands without touching existing code.</li>
<li><strong>Undo/Redo ready</strong> ‚Äî Each command tracks its own state.</li>
<li><strong>Supports macros and batching</strong> ‚Äî You can chain multiple commands together!</li>
</ul>
<h2 id="observer-design-pattern">Observer Design Pattern<a hidden class="anchor" aria-hidden="true" href="#observer-design-pattern">#</a></h2>
<p><img loading="lazy" src="/images/observer.png" alt="Observer Pattern"  />
</p>
<p>Have you ever subscribed to a YouTube channel or followed someone on Twitter? Whenever they post something new, you instantly get notified. That&rsquo;s the Observer Pattern in action ‚Äî one entity (the subject) keeps a list of interested observers and notifies them automatically whenever something changes.</p>
<p>Let&rsquo;s understand how this works and implement it in Go.</p>
<h3 id="problem-manual-notifications-everywhere">Problem: Manual Notifications Everywhere<a hidden class="anchor" aria-hidden="true" href="#problem-manual-notifications-everywhere">#</a></h3>
<p>Imagine a Weather Station that tracks temperature. We have multiple displays ‚Äî say, a phone app, a smartwatch, and a billboard ‚Äî that all need to update whenever the temperature changes.</p>
<p>A naive solution? Call every display&rsquo;s Update() method manually every time the temperature changes:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">temp</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">25</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Temperature updated to&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">temp</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">phoneApp</span><span class="p">.</span><span class="nf">Update</span><span class="p">(</span><span class="nx">temp</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">smartWatch</span><span class="p">.</span><span class="nf">Update</span><span class="p">(</span><span class="nx">temp</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">billboard</span><span class="p">.</span><span class="nf">Update</span><span class="p">(</span><span class="nx">temp</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>This is fine at first, but as more observers join, this gets messy. Every time something changes, we must remember to notify everyone manually.</p>
<p>There must be a better way.</p>
<h3 id="enter-the-observer-pattern">Enter the Observer Pattern<a hidden class="anchor" aria-hidden="true" href="#enter-the-observer-pattern">#</a></h3>
<p>The Observer Design Pattern automates the notification process. Whenever the subject (e.g., Weather Station) changes its state, all observers (e.g., display devices) are automatically notified.</p>
<p>Let&rsquo;s break it down:</p>
<p><strong>Subject</strong> ‚Äî Keeps track of observers and notifies them when something changes.</p>
<p><strong>Observer</strong> ‚Äî Subscribes to the subject and updates itself upon notification.</p>
<h3 id="step-1-defining-the-interfaces">Step 1: Defining the Interfaces<a hidden class="anchor" aria-hidden="true" href="#step-1-defining-the-interfaces">#</a></h3>
<p>We&rsquo;ll start by defining two interfaces: Observer and Subject.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="nx">main</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="s">&#34;fmt&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// Observer defines the interface for all observers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">Observer</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nf">Update</span><span class="p">(</span><span class="nx">temp</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// Subject defines the interface for the subject being observed</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">Subject</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nf">Register</span><span class="p">(</span><span class="nx">observer</span><span class="w"> </span><span class="nx">Observer</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nf">Deregister</span><span class="p">(</span><span class="nx">observer</span><span class="w"> </span><span class="nx">Observer</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nf">NotifyAll</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><strong>Explanation:</strong></p>
<ul>
<li>Observer has an Update() method that gets called when the subject&rsquo;s state changes.</li>
<li>Subject can register, remove, and notify observers.</li>
</ul>
<h3 id="step-2-creating-the-concrete-subject-weatherstation">Step 2: Creating the Concrete Subject (WeatherStation)<a hidden class="anchor" aria-hidden="true" href="#step-2-creating-the-concrete-subject-weatherstation">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">WeatherStation</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">observers</span><span class="w">  </span><span class="p">[]</span><span class="nx">Observer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">temperature</span><span class="w"> </span><span class="kt">int</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// Register adds an observer to the list</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="o">*</span><span class="nx">WeatherStation</span><span class="p">)</span><span class="w"> </span><span class="nf">Register</span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="nx">Observer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">w</span><span class="p">.</span><span class="nx">observers</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">w</span><span class="p">.</span><span class="nx">observers</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// Deregister removes an observer from the list</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="o">*</span><span class="nx">WeatherStation</span><span class="p">)</span><span class="w"> </span><span class="nf">Deregister</span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="nx">Observer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">observer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">observers</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="nx">observer</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">o</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="nx">w</span><span class="p">.</span><span class="nx">observers</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">w</span><span class="p">.</span><span class="nx">observers</span><span class="p">[:</span><span class="nx">i</span><span class="p">],</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">observers</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span><span class="o">...</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			</span><span class="k">break</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// NotifyAll notifies all observers of a state change</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="o">*</span><span class="nx">WeatherStation</span><span class="p">)</span><span class="w"> </span><span class="nf">NotifyAll</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">observer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">observers</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">observer</span><span class="p">.</span><span class="nf">Update</span><span class="p">(</span><span class="nx">w</span><span class="p">.</span><span class="nx">temperature</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// SetTemperature updates the temperature and notifies observers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="o">*</span><span class="nx">WeatherStation</span><span class="p">)</span><span class="w"> </span><span class="nf">SetTemperature</span><span class="p">(</span><span class="nx">temp</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;\nWeatherStation: temperature changed to&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">temp</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">w</span><span class="p">.</span><span class="nx">temperature</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">temp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">w</span><span class="p">.</span><span class="nf">NotifyAll</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><strong>Explanation:</strong></p>
<p>When the temperature changes, the station calls NotifyAll(), which loops through all observers and calls their Update() method.</p>
<h3 id="step-3-creating-concrete-observers">Step 3: Creating Concrete Observers<a hidden class="anchor" aria-hidden="true" href="#step-3-creating-concrete-observers">#</a></h3>
<p>Now, let&rsquo;s create a few displays that observe the weather station.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// PhoneDisplay is a concrete observer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">PhoneDisplay</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="o">*</span><span class="nx">PhoneDisplay</span><span class="p">)</span><span class="w"> </span><span class="nf">Update</span><span class="p">(</span><span class="nx">temp</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;%s received update: Temperature is now %d¬∞C\n&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">temp</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// SmartWatchDisplay is another concrete observer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">SmartWatchDisplay</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="nx">SmartWatchDisplay</span><span class="p">)</span><span class="w"> </span><span class="nf">Update</span><span class="p">(</span><span class="nx">temp</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;%s buzzes: New temperature is %d¬∞C\n&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">temp</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><strong>Explanation:</strong></p>
<p>Both PhoneDisplay and SmartWatchDisplay implement the Observer interface. They each define how they react to updates differently ‚Äî one prints a message, another vibrates.</p>
<h3 id="step-4-putting-it-all-together">Step 4: Putting It All Together<a hidden class="anchor" aria-hidden="true" href="#step-4-putting-it-all-together">#</a></h3>
<p>Let&rsquo;s set up the system in main().</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="c1">// Create the subject</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">weatherStation</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">WeatherStation</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="c1">// Create observers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">phone</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">PhoneDisplay</span><span class="p">{</span><span class="nx">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;Phone App&#34;</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">watch</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">SmartWatchDisplay</span><span class="p">{</span><span class="nx">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;Smart Watch&#34;</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="c1">// Register observers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">weatherStation</span><span class="p">.</span><span class="nf">Register</span><span class="p">(</span><span class="nx">phone</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">weatherStation</span><span class="p">.</span><span class="nf">Register</span><span class="p">(</span><span class="nx">watch</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="c1">// Simulate temperature updates</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">weatherStation</span><span class="p">.</span><span class="nf">SetTemperature</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">weatherStation</span><span class="p">.</span><span class="nf">SetTemperature</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="c1">// Deregister one observer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">weatherStation</span><span class="p">.</span><span class="nf">Deregister</span><span class="p">(</span><span class="nx">watch</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;\nSmart Watch unsubscribed.&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="c1">// Another update</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">weatherStation</span><span class="p">.</span><span class="nf">SetTemperature</span><span class="p">(</span><span class="mi">35</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="what-just-happened-1">What Just Happened?<a hidden class="anchor" aria-hidden="true" href="#what-just-happened-1">#</a></h3>
<p>Here&rsquo;s the flow:</p>
<ol>
<li>Observers register themselves with the subject.</li>
<li>The subject&rsquo;s state (temperature) changes.</li>
<li>The subject automatically notifies all observers.</li>
<li>Observers react to the change in their own way.</li>
</ol>
<p>This decouples the subject (weather station) from the observers (displays). You can add or remove observers anytime ‚Äî no code change in the subject required.</p>
<h3 id="advantages-of-the-observer-pattern">Advantages of the Observer Pattern<a hidden class="anchor" aria-hidden="true" href="#advantages-of-the-observer-pattern">#</a></h3>
<p><strong>Loose Coupling:</strong>
The subject doesn&rsquo;t care who&rsquo;s listening ‚Äî it just broadcasts updates.</p>
<p><strong>Dynamic Subscriptions:</strong>
Observers can join or leave at runtime.</p>
<p><strong>Scalability:</strong>
Add more observers easily without modifying existing code.</p>
<p><strong>Reusability:</strong>
Both subject and observer components can be reused in different contexts.</p>
<h3 id="real-world-uses">Real-World Uses<a hidden class="anchor" aria-hidden="true" href="#real-world-uses">#</a></h3>
<ul>
<li>Event-driven systems</li>
<li>Notification or logging systems</li>
<li>GUI frameworks (button click listeners)</li>
<li>Pub/Sub architectures</li>
</ul>
<h3 id="wrap-up">Wrap-Up<a hidden class="anchor" aria-hidden="true" href="#wrap-up">#</a></h3>
<p>The Observer Pattern is like the notification system of your application ‚Äî simple, scalable, and effective. It decouples your components while keeping everything in sync, like a well-orchestrated broadcast system.</p>
<p>So the next time your app needs a &ldquo;Hey, something just changed!&rdquo; feature, you know which pattern to call.</p>
<h2 id="template-method-design-pattern">Template Method Design Pattern<a hidden class="anchor" aria-hidden="true" href="#template-method-design-pattern">#</a></h2>
<p><img loading="lazy" src="/images/template.png" alt="Template Design Pattern"  />
</p>
<p>Imagine two chefs cooking pasta. One uses basil and parmesan, the other uses chili and garlic ‚Äî but both follow the same overall recipe: boil pasta, prepare sauce, mix, and serve.</p>
<p>That&rsquo;s the Template Method Design Pattern in action.</p>
<p>It defines the skeleton of an algorithm in a method, allowing subclasses (or concrete types) to redefine certain steps without changing the overall flow.</p>
<h3 id="the-core-idea">The Core Idea<a hidden class="anchor" aria-hidden="true" href="#the-core-idea">#</a></h3>
<p>The Template Method Pattern lets you define a general process (the &ldquo;template&rdquo;) and delegate specific steps to subtypes. This keeps the shared logic centralized while allowing variation in behavior.</p>
<p>In Go, since there&rsquo;s no inheritance, we can achieve this behavior using interfaces and composition.</p>
<h3 id="step-1-define-the-template-base-structure">Step 1: Define the Template (Base Structure)<a hidden class="anchor" aria-hidden="true" href="#step-1-define-the-template-base-structure">#</a></h3>
<p>Let&rsquo;s build a program for preparing beverages ‚Äî both Tea and Coffee. They share the same process:</p>
<ol>
<li>Boil water</li>
<li>Brew beverage</li>
<li>Pour into cup</li>
<li>Add condiments</li>
</ol>
<p>But the brewing and condiments differ for each drink.</p>
<p>Here&rsquo;s our template:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="nx">main</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="s">&#34;fmt&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// Beverage defines the steps every drink must follow</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">Beverage</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nf">BoilWater</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nf">Brew</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nf">PourInCup</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nf">AddCondiments</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// Template struct to hold the beverage</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">CaffeineBeverage</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">beverage</span><span class="w"> </span><span class="nx">Beverage</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// PrepareRecipe defines the overall process (the template)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">CaffeineBeverage</span><span class="p">)</span><span class="w"> </span><span class="nf">PrepareRecipe</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">c</span><span class="p">.</span><span class="nx">beverage</span><span class="p">.</span><span class="nf">BoilWater</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">c</span><span class="p">.</span><span class="nx">beverage</span><span class="p">.</span><span class="nf">Brew</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">c</span><span class="p">.</span><span class="nx">beverage</span><span class="p">.</span><span class="nf">PourInCup</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">c</span><span class="p">.</span><span class="nx">beverage</span><span class="p">.</span><span class="nf">AddCondiments</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><strong>Explanation:</strong></p>
<ul>
<li>Beverage defines all steps of the process.</li>
<li>CaffeineBeverage implements the template method PrepareRecipe() ‚Äî the algorithm skeleton.</li>
<li>The concrete beverage (like Tea or Coffee) plugs in its specific behavior.</li>
</ul>
<h3 id="step-2-concrete-implementations">Step 2: Concrete Implementations<a hidden class="anchor" aria-hidden="true" href="#step-2-concrete-implementations">#</a></h3>
<p>Let&rsquo;s define two drinks that share the same steps but differ in how they perform them.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// Tea implements the Beverage interface</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">Tea</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">Tea</span><span class="p">)</span><span class="w"> </span><span class="nf">BoilWater</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Boiling water for tea...&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">Tea</span><span class="p">)</span><span class="w"> </span><span class="nf">Brew</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Steeping the tea leaves...&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">Tea</span><span class="p">)</span><span class="w"> </span><span class="nf">PourInCup</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Pouring tea into cup...&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">Tea</span><span class="p">)</span><span class="w"> </span><span class="nf">AddCondiments</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Adding lemon...&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">// Coffee implements the Beverage interface</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">Coffee</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Coffee</span><span class="p">)</span><span class="w"> </span><span class="nf">BoilWater</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Boiling water for coffee...&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Coffee</span><span class="p">)</span><span class="w"> </span><span class="nf">Brew</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Dripping coffee through filter...&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Coffee</span><span class="p">)</span><span class="w"> </span><span class="nf">PourInCup</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Pouring coffee into cup...&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Coffee</span><span class="p">)</span><span class="w"> </span><span class="nf">AddCondiments</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Adding sugar and milk...&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="step-3-putting-it-all-together">Step 3: Putting It All Together<a hidden class="anchor" aria-hidden="true" href="#step-3-putting-it-all-together">#</a></h3>
<p>Let&rsquo;s run the recipe for both beverages.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Making Tea:&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">tea</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Tea</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">teaMaker</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">CaffeineBeverage</span><span class="p">{</span><span class="nx">beverage</span><span class="p">:</span><span class="w"> </span><span class="nx">tea</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">teaMaker</span><span class="p">.</span><span class="nf">PrepareRecipe</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;\nMaking Coffee:&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">coffee</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Coffee</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">coffeeMaker</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">CaffeineBeverage</span><span class="p">{</span><span class="nx">beverage</span><span class="p">:</span><span class="w"> </span><span class="nx">coffee</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">coffeeMaker</span><span class="p">.</span><span class="nf">PrepareRecipe</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="follow-up-adding-hooks-for-flexibility">Follow-Up: Adding Hooks for Flexibility<a hidden class="anchor" aria-hidden="true" href="#follow-up-adding-hooks-for-flexibility">#</a></h3>
<p>Sometimes, you might want to make some steps optional. For instance, the user can choose whether to add condiments.</p>
<p>We can achieve that using a hook ‚Äî a method that subclasses can override to change the behavior.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// BeverageWithHook adds a hook for condiments</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">BeverageWithHook</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">Beverage</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nf">WantsCondiments</span><span class="p">()</span><span class="w"> </span><span class="kt">bool</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">CaffeineBeverageWithHook</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">beverage</span><span class="w"> </span><span class="nx">BeverageWithHook</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">CaffeineBeverageWithHook</span><span class="p">)</span><span class="w"> </span><span class="nf">PrepareRecipe</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">c</span><span class="p">.</span><span class="nx">beverage</span><span class="p">.</span><span class="nf">BoilWater</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">c</span><span class="p">.</span><span class="nx">beverage</span><span class="p">.</span><span class="nf">Brew</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">c</span><span class="p">.</span><span class="nx">beverage</span><span class="p">.</span><span class="nf">PourInCup</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">beverage</span><span class="p">.</span><span class="nf">WantsCondiments</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">c</span><span class="p">.</span><span class="nx">beverage</span><span class="p">.</span><span class="nf">AddCondiments</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>Now, let&rsquo;s modify Tea to include the hook:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span><span class="w"> </span><span class="nx">TeaWithHook</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">addCondiments</span><span class="w"> </span><span class="kt">bool</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">TeaWithHook</span><span class="p">)</span><span class="w"> </span><span class="nf">BoilWater</span><span class="p">()</span><span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Boiling water for tea...&#34;</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">TeaWithHook</span><span class="p">)</span><span class="w"> </span><span class="nf">Brew</span><span class="p">()</span><span class="w">           </span><span class="p">{</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Steeping the tea leaves...&#34;</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">TeaWithHook</span><span class="p">)</span><span class="w"> </span><span class="nf">PourInCup</span><span class="p">()</span><span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Pouring tea into cup...&#34;</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">TeaWithHook</span><span class="p">)</span><span class="w"> </span><span class="nf">AddCondiments</span><span class="p">()</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Adding lemon...&#34;</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">TeaWithHook</span><span class="p">)</span><span class="w"> </span><span class="nf">WantsCondiments</span><span class="p">()</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">addCondiments</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>Test it:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">tea</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">TeaWithHook</span><span class="p">{</span><span class="nx">addCondiments</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">teaMaker</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">CaffeineBeverageWithHook</span><span class="p">{</span><span class="nx">beverage</span><span class="p">:</span><span class="w"> </span><span class="nx">tea</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Making Tea with hook (no condiments):&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nx">teaMaker</span><span class="p">.</span><span class="nf">PrepareRecipe</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="why-use-the-template-method-pattern">Why Use the Template Method Pattern?<a hidden class="anchor" aria-hidden="true" href="#why-use-the-template-method-pattern">#</a></h3>
<p><strong>Reuse and Consistency</strong></p>
<p>Common logic lives in one place ‚Äî PrepareRecipe() ‚Äî so you avoid duplication.</p>
<p><strong>Extensibility</strong></p>
<p>You can easily create new variations (like &ldquo;GreenTea&rdquo; or &ldquo;Espresso&rdquo;) without changing existing code.</p>
<p><strong>Enforces a Defined Process</strong></p>
<p>It ensures that the steps happen in a specific order, every single time.</p>
<p><strong>Adds Controlled Customization</strong></p>
<p>Hooks give flexibility to subclasses without breaking the core algorithm.</p>
<h3 id="real-world-analogy">Real-World Analogy<a hidden class="anchor" aria-hidden="true" href="#real-world-analogy">#</a></h3>
<p>Think of it like a cooking recipe in a cooking class. The instructor (template) dictates the overall sequence ‚Äî &ldquo;Boil, Cook, Serve.&rdquo; Each student (concrete class) personalizes it with their own ingredients or spices ‚Äî but they still follow the same flow.</p>
<h3 id="to-wrap-it-up">To wrap it up<a hidden class="anchor" aria-hidden="true" href="#to-wrap-it-up">#</a></h3>
<p>The Template Method Pattern is perfect when:</p>
<ul>
<li>You have a set of similar operations that share the same workflow.</li>
<li>You want to enforce consistency but allow variation in specific steps.</li>
</ul>
<p>It&rsquo;s widely used in frameworks, libraries, and even Go applications where a core logic must remain stable, but the details can vary ‚Äî like processing pipelines, parsers, and report generators.</p>
<h2 id="tldr-1">TLDR;<a hidden class="anchor" aria-hidden="true" href="#tldr-1">#</a></h2>
<table>
  <thead>
      <tr>
          <th><strong>Pattern</strong></th>
          <th><strong>Purpose (in short)</strong></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>Chain of Responsibility</strong></td>
          <td>Passes a request along a chain of handlers until one processes it.</td>
      </tr>
      <tr>
          <td><strong>Command</strong></td>
          <td>Encapsulates a request as an object, allowing undo/redo and flexible execution.</td>
      </tr>
      <tr>
          <td><strong>Iterator</strong></td>
          <td>Provides a way to sequentially access elements of a collection without exposing its structure.</td>
      </tr>
      <tr>
          <td><strong>Mediator</strong></td>
          <td>Centralizes communication between multiple objects to reduce direct dependencies.</td>
      </tr>
      <tr>
          <td><strong>Memento</strong></td>
          <td>Captures and restores an object‚Äôs internal state without exposing its details.</td>
      </tr>
      <tr>
          <td><strong>Observer</strong></td>
          <td>Notifies dependent objects automatically when the subject‚Äôs state changes.</td>
      </tr>
      <tr>
          <td><strong>State</strong></td>
          <td>Lets an object change its behavior when its internal state changes.</td>
      </tr>
      <tr>
          <td><strong>Strategy</strong></td>
          <td>Defines a family of algorithms and makes them interchangeable at runtime.</td>
      </tr>
      <tr>
          <td><strong>Template Method</strong></td>
          <td>Defines the skeleton of an algorithm and lets subclasses redefine certain steps.</td>
      </tr>
      <tr>
          <td><strong>Visitor</strong></td>
          <td>Adds new operations to existing object structures without modifying them.</td>
      </tr>
  </tbody>
</table>
<p>Next in the series, we&rsquo;ll look into Structural Design Patterns.</p>


    </div>
    <footer class="post-footer">
        <ul class="post-tags">
            <li>
                <a href="http://localhost:1313/tags/tech/">Tech</a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/golang/">Golang</a>
            </li>
        </ul>


<ul class="share-buttons">
    <li>
        <a target="_blank"
           rel="noopener noreferrer"
           aria-label="share Behavioral Design Pattern in Golang on x"
           href="https://x.com/intent/tweet/?text=Behavioral%20Design%20Pattern%20in%20Golang&amp;url=http%3a%2f%2flocalhost%3a1313%2farchive%2fold_posts%2fbehavioral-design-pattern-golang%2f&amp;hashtags=tech%2cgolang">
            <svg version="1.1"
                 viewBox="0 0 512 512"
                 xml:space="preserve"
                 height="30px"
                 width="30px"
                 fill="currentColor">
                <path d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank"
           rel="noopener noreferrer"
           aria-label="share Behavioral Design Pattern in Golang on linkedin"
           href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2farchive%2fold_posts%2fbehavioral-design-pattern-golang%2f&amp;title=Behavioral%20Design%20Pattern%20in%20Golang&amp;summary=Behavioral%20Design%20Pattern%20in%20Golang&amp;source=http%3a%2f%2flocalhost%3a1313%2farchive%2fold_posts%2fbehavioral-design-pattern-golang%2f">
            <svg version="1.1"
                 viewBox="0 0 512 512"
                 xml:space="preserve"
                 height="30px"
                 width="30px"
                 fill="currentColor">
                <path d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank"
           rel="noopener noreferrer"
           aria-label="share Behavioral Design Pattern in Golang on reddit"
           href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2farchive%2fold_posts%2fbehavioral-design-pattern-golang%2f&title=Behavioral%20Design%20Pattern%20in%20Golang">
            <svg version="1.1"
                 viewBox="0 0 512 512"
                 xml:space="preserve"
                 height="30px"
                 width="30px"
                 fill="currentColor">
                <path d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank"
           rel="noopener noreferrer"
           aria-label="share Behavioral Design Pattern in Golang on facebook"
           href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2farchive%2fold_posts%2fbehavioral-design-pattern-golang%2f">
            <svg version="1.1"
                 viewBox="0 0 512 512"
                 xml:space="preserve"
                 height="30px"
                 width="30px"
                 fill="currentColor">
                <path d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank"
           rel="noopener noreferrer"
           aria-label="share Behavioral Design Pattern in Golang on whatsapp"
           href="https://api.whatsapp.com/send?text=Behavioral%20Design%20Pattern%20in%20Golang%20-%20http%3a%2f%2flocalhost%3a1313%2farchive%2fold_posts%2fbehavioral-design-pattern-golang%2f">
            <svg version="1.1"
                 viewBox="0 0 512 512"
                 xml:space="preserve"
                 height="30px"
                 width="30px"
                 fill="currentColor">
                <path d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank"
           rel="noopener noreferrer"
           aria-label="share Behavioral Design Pattern in Golang on telegram"
           href="https://telegram.me/share/url?text=Behavioral%20Design%20Pattern%20in%20Golang&amp;url=http%3a%2f%2flocalhost%3a1313%2farchive%2fold_posts%2fbehavioral-design-pattern-golang%2f">
            <svg version="1.1"
                 xml:space="preserve"
                 viewBox="2 2 28 28"
                 height="30px"
                 width="30px"
                 fill="currentColor">
                <path d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank"
           rel="noopener noreferrer"
           aria-label="share Behavioral Design Pattern in Golang on ycombinator"
           href="https://news.ycombinator.com/submitlink?t=Behavioral%20Design%20Pattern%20in%20Golang&u=http%3a%2f%2flocalhost%3a1313%2farchive%2fold_posts%2fbehavioral-design-pattern-golang%2f">
            <svg version="1.1"
                 xml:space="preserve"
                 width="30px"
                 height="30px"
                 viewBox="0 0 512 512"
                 fill="currentColor"
                 xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

    </footer>
</article>
    </main>
    
<footer class="footer">
    
    <a href="http://localhost:1313/donate" class="donate-big">Liked my blog and want to support? Click this button to donate!</a>
    <style>
    .donate-big {
      display: block;
      width: 100%;
      text-align: center;
      padding: 1rem 1.25rem;
      background: var(--primary);
      color: var(--theme) !important;
      border-radius: 0.75rem;
      font-size: 1.05rem;
      font-weight: 600;
      text-decoration: none;
      margin-bottom: 1.5rem;

      transition: background 0.2s ease;
    }
    </style>
    
    
<style>
   
  input.autofill-fix:-webkit-autofill,
  input.autofill-fix:-webkit-autofill:hover,
  input.autofill-fix:-webkit-autofill:focus,
  input.autofill-fix:-webkit-autofill:active {
    -webkit-text-fill-color: var(--primary2) !important;
    caret-color: var(--primary2) !important;
    -webkit-box-shadow: 0 0 0px 1000px var(--entry) inset !important;
    box-shadow: 0 0 0px 1000px var(--entry) inset !important;
    background-color: var(--entry) !important;
    transition: background-color 9999s ease-in-out 0s;
  }
</style>
<div style="max-width: 100%;
            margin: 2rem auto;
            padding: 1.5rem;
            border: 0.5px solid var(--border);
            border-radius: 12px;
            background: var(--entry)">
    <form action="https://buttondown.com/api/emails/embed-subscribe/jitesh117"
          target="_blank"
          method="post"
          class="embeddable-buttondown-form"
          style="text-align: left">
        <label for="bd-email"
               style="display: block;
                      margin-bottom: 0.5rem;
                      font-weight: 600;
                      font-size: 1rem;
                      color: var(--primary2)">Join the newsletter!</label>
        <input type="email"
               name="email"
               id="bd-email"
               class="autofill-fix"
               placeholder="you@example.com"
               required
               style="width: 100%;
                      padding: 0.65rem;
                      border: 1px solid #ccc;
                      border-radius: 8px;
                      margin-bottom: 1rem;
                      color: var(--primary2)" />
        <input type="submit"
               value="Subscribe"
               style="width: 100%;
                      padding: 0.75rem;
                      background: var(--primary);
                      color: var(--theme);
                      border: none;
                      border-radius: 8px;
                      font-weight: 600;
                      font-size: 1rem;
                      cursor: pointer" />
        <p style="font-size: 0.85rem; margin-top: 1rem; text-align: center"></p>
    </form>
</div>


    <span>&copy; 2026 <a href="http://localhost:1313/">Uday Parmar</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/"
           rel="noopener"
           target="_blank">PaperMod</a>
    </span>
    <span>¬∑</span>
    <span>
        <a target="_blank" href="https://jitesh117.github.io/index.xml">RSS Feed</a>
    </span>
    <span>¬∑</span>
    <span>
        <a target="_blank" href="https://buymeacoffee.com/jitesh117">Support my writing!</a>
    </span>
</footer><style>
  @media (max-width: 768px) {
    #bmc-iframe {
      border-radius: 0 !important;
    }
  }
</style>
<script
  data-name="BMC-Widget"
  data-cfasync="false"
  src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js"
  data-id="jitesh117"
  data-description="Support me on Buy me a coffee!"
  data-message="Like what you're reading? You can donate to support my writing!"
  data-color="#FFDD00"
  data-position="Right"
  data-x_margin="18"
  data-y_margin="18"
></script>
<style>
   
  @media (max-width: 1500px) {
    #bmc-iframe {
      border-radius: 0 !important;
    }

     
    .graph-fab {
      position: fixed;
      bottom: 18px;
      left: 18px;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background-color: var(--primary);
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.25);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 100;
      transition: all 0.3s;
      border: 2px solid rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(2px);
    }

    .graph-fab:hover {
      transform: scale(1.05);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.35);
    }

    .graph-fab img {
      width: 30px;
      height: 30px;
      object-fit: contain;
      filter: brightness(1.1);
    }

    .graph-container {
      position: fixed;
      bottom: 85px;
      left: 18px;
      width: 350px;
      height: 350px;
      background-color: var(--code-bg);
      border-radius: 12px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.25);
      padding: 15px;
      z-index: 99;
      display: none;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .graph-container.active {
      display: block;
      animation: fadeIn 0.3s ease-in-out;
    }
  }

   
  @media (min-width: 1501px) {
    .graph-fab {
      display: none;  
    }

    .graph-container {
      position: fixed;
      top: 50%;
      left: calc(((100% - 700px) / 2) / 2);  
      transform: translateY(-50%) translateX(-50%);  
      width: 350px;  
      height: 350px;
      background-color: var(--code-bg);
      border-radius: 12px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.25);
      padding: 15px;
      z-index: 99;
      display: block;  
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
  }

   
  .graph-container svg {
    display: block;
    margin: 0 auto;
    width: 100% !important;
    height: calc(100% - 40px) !important;
  }

  .graph-container svg g {
     
     
  }

  .graph-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 5px 0;
    margin-bottom: 5px;
    border-bottom: 1px solid rgba(125, 125, 125, 0.2);
  }

  .graph-title {
    font-size: 14px;
    color: var(--primary);
    padding: 0 10px;
    font-weight: 500;
  }

   
  .zoom-instructions {
    font-size: 12px;
    font-style: italic;
    opacity: 0.8;
    font-weight: normal;
    margin-left: 5px;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @media (max-width: 400px) {
    .graph-container {
      width: calc(100% - 36px);
    }
  }
</style>


<div id="graph-container" class="graph-container">
  <div class="graph-controls">
    <div class="graph-title">
      Topic Graph
      <span class="zoom-instructions">(Use scroll wheel to zoom)</span>
    </div>
  </div>
  <div class="component-graph-container" id="container-floating-graph">
  <div class="component-graph" id="floating-graph"></div>
</div>
<style>
  .component-graph-container {
      position: relative;
      width: 100%;
      margin: 20px 0;
      border-radius: 8px;
  }

  .component-graph {
      width: 100%;
        
      aspect-ratio: 1;
      border-radius: 16px;
      background-color: var(--code-bg, #f5f5f5);
      overflow: hidden;
  }

  .node-label {
      font-size: 10px;
      text-anchor: middle;
      pointer-events: none;
      font-family: sans-serif;
      fill: #333;
      user-select: none;
      opacity: 0;  
      transition: opacity 0.3s;
  }

  .node-label-background {
      fill: rgba(255, 255, 255, 0.8);
      rx: 3;
      ry: 3;
      pointer-events: none;
      opacity: 0;  
      transition: opacity 0.3s;
  }

  .tag-label {
      font-size: 12px;
      font-weight: bold;
      text-anchor: middle;
      pointer-events: none;
      font-family: sans-serif;
      fill: var(--primary);
      user-select: none;
  }

  .node-tooltip {
      position: absolute;
      padding: 8px 12px;
      background: rgba(0, 0, 0, 0.8);
      color: #fff;
      border-radius: 4px;
      font-size: 12px;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.2s;
      z-index: 100;
      max-width: 200px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
  }
</style>
<script>
    (function () {
      
      let graphData = { nodes: [], links: [] };
      let simulation;
      let svg;
      let g; 
      let currentZoomScale = 1; 
      const zoomThreshold = 1.5; 
      const graphId = "floating-graph";
      const jsonPath = "\/index.json";
      const graphElement = document.getElementById(graphId);

      
      const colorPalette = [
        "#f28e2c",
        "#04ff00",
        "#b342f5",
        "#e6327a",
        "#edc949",
        "#76b7b2",
        "#af7aa1",
        "#9c755f",
        "#bab0ab",
        "#6b9ac4",
        "#d7a763",
        "#d37372",
        "#a4ccc9",
        "#8bb174",
        "#f1d78c",
      ];

      
      const tooltip = document.createElement("div");
      tooltip.className = "node-tooltip";
      document.getElementById(`container-${graphId}`).appendChild(tooltip);

      
      function initGraph() {
        
        const width = graphElement.clientWidth;
        const height = graphElement.clientHeight;

        
        if (graphElement.querySelector("svg")) {
          graphElement.querySelector("svg").remove();
        }

        
        svg = d3
          .select("#" + graphId)
          .append("svg")
          .attr("width", width)
          .attr("height", height)
          .attr("viewBox", `0 0 ${width} ${height}`);

        
        const zoom = d3
          .zoom()
          .scaleExtent([0.1, 10])
          .on("zoom", (event) => {
            g.attr("transform", event.transform);
            currentZoomScale = event.transform.k;

            
            updateLabelsVisibility(currentZoomScale);

            
            if (simulation) {
              adjustNodeSpacing(currentZoomScale);
            }
          });

        svg.call(zoom);

        
        g = svg.append("g");

        
        const tagConnections = {};
        graphData.nodes.forEach((node) => {
          if (node.isTag) {
            tagConnections[node.id] = 0;
          }
        });

        graphData.links.forEach((link) => {
          if (link.source.id) {
            if (tagConnections[link.source.id] !== undefined) {
              tagConnections[link.source.id]++;
            }
          } else if (tagConnections[link.source] !== undefined) {
            tagConnections[link.source]++;
          }
        });

        
        graphData.nodes.forEach((node) => {
          if (node.isTag) {
            const connectionCount = tagConnections[node.id] || 1;
            node.radius = Math.max(8, Math.min(14, 5 + connectionCount * 0.8));
            node.connections = connectionCount;
          } else {
            node.radius = 5;
          }
        });

        
        simulation = d3
          .forceSimulation(graphData.nodes)
          .force(
            "link",
            d3
              .forceLink(graphData.links)
              .id((d) => d.id)
              .distance((d) => {
                
                if (d.source.isTag) {
                  return 80 + d.source.connections * 2;
                }
                return 50;
              }),
          )
          .force(
            "charge",
            d3.forceManyBody().strength((d) => (d.isTag ? -300 : -50)),
          )
          .force("center", d3.forceCenter(width / 2, height / 2))
          .force(
            "collision",
            d3.forceCollide().radius((d) => d.radius * 1.5),
          )
          .force("x", d3.forceX(width / 2).strength(0.1))
          .force("y", d3.forceY(height / 2).strength(0.1));

        
        const link = g
          .append("g")
          .attr("class", "links")
          .selectAll("line")
          .data(graphData.links)
          .enter()
          .append("line")
          .attr("stroke", "#888888") 
          .attr("stroke-opacity", 0.6)
          .attr("stroke-width", 1)
          .attr("data-source", (d) => d.source.id || d.source)
          .attr("data-target", (d) => d.target.id || d.target)
          .style("transition", "opacity 0.3s, stroke 0.3s, stroke-width 0.3s"); 

        
        const nodeGroup = g
          .append("g")
          .attr("class", "nodes")
          .selectAll("g")
          .data(graphData.nodes)
          .enter()
          .append("g")
          .attr("data-id", (d) => d.id)
          .style("cursor", "pointer")
          .call(drag(simulation))
          .on("click", (event, d) => {
            
            handleNodeClick(d);

            
            if (!d.isTag && (d.link || d.permalink)) {
              window.open(d.link || d.permalink, "_blank");
            } else if (d.isTag) {
                  
                  const tagName = d.title.replace(/\s+/g, "-");
                  const tagPermalink = 
                    "http://localhost:1313/tags/" + tagName.toLowerCase()
                  ;
                  window.open(tagPermalink, "_blank");
                }
          })
          .on("mouseover", (event, d) => {
            
            const tooltipText = d.isTag
              ? `Tag: ${d.title} (${d.connections} posts)`
              : d.title;
            showTooltip(tooltipText, event.pageX, event.pageY);
            highlightConnections(d);
          })
          .on("mousemove", (event) => {
            
            updateTooltipPosition(event.pageX, event.pageY);
          })
          .on("mouseout", () => {
            
            hideTooltip();
            resetHighlighting();
          });

        
        nodeGroup
          .append("circle")
          .attr("r", (d) => d.radius)
          .attr("fill", (d) => {
            if (d.isTag) {
              return colorPalette[d.colorIndex];
            }
            return "#ffffff";
          })
          .attr("stroke", (d) => (d.isTag ? "#333333" : "#888888"))
          .attr("stroke-width", (d) => (d.isTag ? 1.5 : 1))
          .style("transition", "opacity 0.3s, fill 0.3s, stroke-width 0.3s");

        
        nodeGroup
          .filter((d) => d.isTag)
          .append("text")
          .attr("class", "tag-label")
          .attr("dy", (d) => d.radius + 12) 
          .text((d) => d.title)
          .style("opacity", 0.85)
          .style("fill", (d) => {
            
            const color = d3.color(colorPalette[d.colorIndex]);
          })
          .each(function (d) {
            d.hasTagLabel = true; 
          });

        
        const labelGroups = nodeGroup
          .filter((d) => !d.hasTagLabel) 
          .append("g")
          .attr("class", "label-group");

        
        labelGroups
          .append("rect")
          .attr("class", "node-label-background")
          .attr("x", -40)
          .attr("y", (d) => d.radius + 2)
          .attr("width", 80) 
          .attr("height", 16)
          .style("opacity", 0);

        
        const labels = labelGroups
          .append("text")
          .attr("class", "node-label")
          .attr("dy", (d) => d.radius + 14) 
          .text((d) => d.title)
          .style("opacity", 0); 

        
        labels.each(function () {
          const bbox = this.getBBox();
          const parent = d3.select(this.parentNode);
          parent
            .select("rect")
            .attr("x", bbox.x - 2)
            .attr("width", bbox.width + 4);
        });

        
        function updateLabelsVisibility(scale) {
          
          nodeGroup
            .selectAll(".node-label")
            .style("opacity", scale >= zoomThreshold ? 1 : 0);
          nodeGroup
            .selectAll(".node-label-background")
            .style("opacity", scale >= zoomThreshold ? 0.8 : 0);

          
          nodeGroup
            .filter((d) => d.isTag)
            .selectAll(".tag-label")
            .style("opacity", 0.85);
        }

        
        function adjustNodeSpacing(scale) {
          
          const zoomFactor = Math.max(0, (scale - 1) * 1.2);

          
          const collisionRadius = (d) => {
            const baseRadius = d.radius * 1.5;
            return baseRadius * (1 + zoomFactor);
          };

          
          const linkDistance = (d) => {
            const baseDistance = d.source.isTag
              ? 80 + d.source.connections * 3
              : 60;
            return baseDistance * (1 + zoomFactor * 1.5);
          };

          
          const chargeStrength = (d) => {
            const baseCharge = d.isTag ? -300 : -50;
            return baseCharge * (1 + zoomFactor);
          };

          
          simulation
            .force("collision", d3.forceCollide().radius(collisionRadius))
            .force(
              "link",
              d3
                .forceLink(graphData.links)
                .id((d) => d.id)
                .distance(linkDistance),
            )
            .force("charge", d3.forceManyBody().strength(chargeStrength))
            .alpha(0.3) 
            .restart();
        }

        
        let isDragging = false;

        
        function handleNodeClick(d) {
          
          nodeGroup
            .selectAll("circle")
            .attr("fill", (n) => {
              if (n.isTag) {
                return colorPalette[n.colorIndex];
              }
              return "#ffffff";
            })
            .attr("stroke-width", (n) => (n.isTag ? 1.5 : 1));

          link
            .attr("stroke", "#888888")
            .attr("stroke-width", 1)
            .attr("stroke-opacity", 0.6);

          
          nodeGroup
            .filter((n) => n.id === d.id)
            .select("circle")
            .attr("stroke-width", 2.5)
            .attr("stroke", "#000000");

          const connectedNodes = [];

          if (d.isTag) {
            
            link.each(function (l) {
              if (l.source.id === d.id || l.source === d.id) {
                
                d3.select(this)
                  .attr("stroke", colorPalette[d.colorIndex])
                  .attr("stroke-width", 2)
                  .attr("stroke-opacity", 1);
                connectedNodes.push(l.target.id || l.target);
              }
            });
          } else {
            
            const connectedTagColors = {};

            link.each(function (l) {
              if (l.target.id === d.id || l.target === d.id) {
                const sourceId = l.source.id || l.source;
                const tagNode = graphData.nodes.find((n) => n.id === sourceId);
                if (tagNode) {
                  const tagColor = colorPalette[tagNode.colorIndex];
                  connectedTagColors[sourceId] = tagColor;

                  
                  d3.select(this)
                    .attr("stroke", tagColor)
                    .attr("stroke-width", 2)
                    .attr("stroke-opacity", 1);

                  connectedNodes.push(sourceId);
                }
              }
            });
          }

          
          nodeGroup
            .filter((n) => connectedNodes.includes(n.id))
            .select("circle")
            .attr("stroke-width", 2)
            .attr("stroke", "#000000");
        }

        
        function highlightConnections(d) {
          if (isDragging) return; 

          
          nodeGroup.style("opacity", 0.4);
          link.style("opacity", 0.1);

          
          nodeGroup.filter((n) => n.id === d.id).style("opacity", 1);

          const connectedNodes = [];

          if (d.isTag) {
            
            link.each(function (l) {
              if (l.source.id === d.id || l.source === d.id) {
                
                d3.select(this)
                  .style("opacity", 1)
                  .attr("stroke", colorPalette[d.colorIndex])
                  .attr("stroke-width", 1.5);
                connectedNodes.push(l.target.id || l.target);
              }
            });
          } else {
            
            link.each(function (l) {
              if (l.target.id === d.id || l.target === d.id) {
                const sourceId = l.source.id || l.source;
                const tagNode = graphData.nodes.find((n) => n.id === sourceId);

                if (tagNode) {
                  
                  d3.select(this)
                    .style("opacity", 1)
                    .attr("stroke", colorPalette[tagNode.colorIndex])
                    .attr("stroke-width", 1.5);
                  connectedNodes.push(sourceId);
                }
              }
            });
          }

          
          nodeGroup
            .filter((n) => connectedNodes.includes(n.id))
            .style("opacity", 1);
        }

        
        function resetHighlighting() {
          if (isDragging) return; 
          nodeGroup.style("opacity", 1);
          link
            .style("opacity", 0.6)
            .attr("stroke", "#888888")
            .attr("stroke-width", 1);
        }

        
        simulation.on("tick", () => {
          link
            .attr("x1", (d) => d.source.x)
            .attr("y1", (d) => d.source.y)
            .attr("x2", (d) => d.target.x)
            .attr("y2", (d) => d.target.y);

          nodeGroup.attr("transform", (d) => `translate(${d.x},${d.y})`);
        });
      }

      
      function showTooltip(text, x, y) {
        tooltip.textContent = text;
        tooltip.style.opacity = "1";
        updateTooltipPosition(x, y);
      }

      function updateTooltipPosition(x, y) {
        const rect = graphElement.getBoundingClientRect();
        const offsetX = x - rect.left;
        const offsetY = y - rect.top;

        tooltip.style.left = `${offsetX + 15}px`;
        tooltip.style.top = `${offsetY - 10}px`;
      }

      function hideTooltip() {
        tooltip.style.opacity = "0";
      }

      
      function drag(simulation) {
        function dragstarted(event) {
          if (!event.active) simulation.alphaTarget(0.3).restart();
          event.subject.fx = event.subject.x;
          event.subject.fy = event.subject.y;
          isDragging = true;
        }

        function dragged(event) {
          event.subject.fx = event.x;
          event.subject.fy = event.y;
        }

        function dragended(event) {
          if (!event.active) simulation.alphaTarget(0);
          event.subject.fx = null;
          event.subject.fy = null;
          setTimeout(() => {
            isDragging = false;
          }, 100);
        }

        return d3
          .drag()
          .on("start", dragstarted)
          .on("drag", dragged)
          .on("end", dragended);
      }

      
      function processHugoData(data) {
        const postNodes = data.map((post, index) => ({
          id: "post-" + index,
          title: post.title,
          permalink: post.permalink,
          link: post.link || post.permalink,
          tags: post.tags || [],
          isTag: false,
        }));

        
        const allTags = new Set();
        postNodes.forEach((post) => {
          if (post.tags && post.tags.length > 0) {
            post.tags.forEach((tag) => allTags.add(tag));
          }
        });

        
        const tagNodes = Array.from(allTags).map((tag) => ({
          id: "tag-" + tag.replace(/\s+/g, "-").toLowerCase(),
          title: tag,
          isTag: true,
          colorIndex: 0, 
        }));

        
        const links = [];
        postNodes.forEach((post) => {
          if (post.tags && post.tags.length > 0) {
            post.tags.forEach((tag) => {
              const tagId = "tag-" + tag.replace(/\s+/g, "-").toLowerCase();
              links.push({
                source: tagId,
                target: post.id,
                value: 1,
              });
            });
          }
        });

        
        const tagAdjacencyMap = createTagAdjacencyMap(tagNodes, links);

        
        applyGraphColoring(tagNodes, tagAdjacencyMap);

        
        const nodes = [...tagNodes, ...postNodes];

        return { nodes, links };
      }

      
      function createTagAdjacencyMap(tagNodes, links) {
        const tagIds = tagNodes.map((tag) => tag.id);
        const adjacencyMap = {};

        
        tagIds.forEach((tagId) => {
          adjacencyMap[tagId] = new Set();
        });

        
        const postToTagsMap = {};

        
        links.forEach((link) => {
          const sourceId = link.source.id || link.source;
          const targetId = link.target.id || link.target;

          
          if (sourceId.startsWith("tag-") && !targetId.startsWith("tag-")) {
            if (!postToTagsMap[targetId]) {
              postToTagsMap[targetId] = [];
            }
            postToTagsMap[targetId].push(sourceId);
          }
        });

        
        Object.values(postToTagsMap).forEach((connectedTags) => {
          if (connectedTags.length > 1) {
            
            for (let i = 0; i < connectedTags.length; i++) {
              for (let j = 0; j < connectedTags.length; j++) {
                if (i !== j) {
                  adjacencyMap[connectedTags[i]].add(connectedTags[j]);
                }
              }
            }
          }
        });

        return adjacencyMap;
      }

      
      function applyGraphColoring(tagNodes, adjacencyMap) {
        
        const sortedTags = [...tagNodes].sort((a, b) => {
          const degreeA = adjacencyMap[a.id] ? adjacencyMap[a.id].size : 0;
          const degreeB = adjacencyMap[b.id] ? adjacencyMap[b.id].size : 0;
          return degreeB - degreeA; 
        });

        
        sortedTags.forEach((tagNode) => {
          const usedColors = new Set();

          
          if (adjacencyMap[tagNode.id]) {
            adjacencyMap[tagNode.id].forEach((adjacentTagId) => {
              
              const adjacentTag = tagNodes.find((t) => t.id === adjacentTagId);
              if (adjacentTag && adjacentTag.colorIndex !== undefined) {
                usedColors.add(adjacentTag.colorIndex);
              }
            });
          }

          
          let colorIndex = 0;
          while (usedColors.has(colorIndex)) {
            colorIndex++;
          }
          tagNode.colorIndex = colorIndex % colorPalette.length;
        });
      }

      
      function loadGraphData() {
  const jsonPath = "\/index.json";
  fetch(jsonPath)
          .then((response) => {
            if (!response.ok) {
              throw new Error("Network response was not ok");
            }
            return response.json();
          })
          .then((data) => {
            graphData = processHugoData(data);
            initGraph();
          })
          .catch((error) => {
            console.error("Error loading blog graph data:", error);
            graphElement.innerHTML =
              '<div style="padding: 20px; text-align: center;">Error loading blog graph data.</div>';
          });
      }

      
      window.addEventListener("resize", () => {
        if (simulation) {
          initGraph();
        }
      });

      
      function loadScript(url, callback) {
        if (typeof d3 !== "undefined") {
          callback();
          return;
        }

        const script = document.createElement("script");
        script.type = "text/javascript";
        script.src = url;
        script.onload = callback;
        document.head.appendChild(script);
      }

      
      loadScript(
        "https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js",
        loadGraphData,
      );
    })();
</script>

</div>

<div id="graph-fab" class="graph-fab">
  <img src="/images/graph_icon.png" alt="Graph" />
</div>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const fab = document.getElementById("graph-fab");
    const container = document.getElementById("graph-container");
    let graphInitialized = false;
    const isMobile = window.innerWidth <= 1500;

    
    if (!isMobile) {
      setTimeout(function () {
        window.dispatchEvent(new Event("resize"));
        graphInitialized = true;
      }, 500);
    }

    if (fab) {
      fab.addEventListener("click", function () {
        container.classList.toggle("active");

        
        if (!graphInitialized && container.classList.contains("active")) {
          setTimeout(function () {
            window.dispatchEvent(new Event("resize"));
            graphInitialized = true;
          }, 100);
        }
      });
    }

    
    document.addEventListener("click", function (event) {
      if (
        isMobile &&
        container &&
        !container.contains(event.target) &&
        fab &&
        !fab.contains(event.target) &&
        container.classList.contains("active")
      ) {
        container.classList.remove("active");
      }
    });
  });
</script>


<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
